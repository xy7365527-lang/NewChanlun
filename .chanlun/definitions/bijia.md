# 比价关系（Bijia / Ratio Relation）

**版本**: v1.0
**状态**: 已结算
**最后更新**: 2026-02-18
**维度**: 跨标的（空间维度）
**原文依据**: 第9课、第72/73课
**规范文件**: `docs/spec/ratio_relation_v1.md`

---

## 维度定位

比价关系是缠论形式语法在**跨标的维度**上的基础概念。

前 9 个定义（分型→笔→线段→中枢→走势→背驰→买卖点+包含+级别递归）构成**单标的内部**的语法元素，彼此有严格的生成序。比价关系不是生成序的第 10 个环节，而是在**另一个维度**上的基础元素。

**关键结构**：比价K线产出后，其上运行的仍然是单标的那套完整语法（分型→笔→线段→中枢→走势→...）。比价关系定义的是**跨标的维度的原子**，内部结构**复用**单标的定义集。

```
单标的维度：  分型 → 笔 → 线段 → 中枢 → 走势 → ...
                ↑                              ↑
跨标的维度：  比价K线 ─────复用──────────────→ 比价走势结构
              （本定义）                      （携带资本流转语义）
```

---

## 原文谱系

### 第9课 (2006-12-01) — 首次阐述

> "任何一个股票都不是独立的，在整个股票市场中，处在一定的比价关系中，这个比价关系的变动，也可以构成一个买卖系统，这个买卖系统是和市场资金的流向相关的。"

**要点**：
- 比价变动构成**独立的买卖系统**（不是附属于单标的分析的工具）
- 买卖系统 = 独立的缠论分析系统 [旧缠论:隐含]
- 资本流转含义：比价走势反映市场资金流向 [旧缠论]

### 第72课 (2007-08-13) — 三个独立系统

> 技术分析、比价关系、基本面分析构成三个独立的分析系统。

**要点**：
- 比价关系的独立地位被明确化
- 三个系统各自提供独立的买卖信号
- 三者共振时信号最强

### 第73课 (2007-08-14) — 市场配置

进一步阐述比价关系在市场配置中的应用。

### 谱系小结

| 阶段 | 课号 | 性质 | 关键内容 |
|------|------|------|---------|
| 首次阐述 | 第9课 | 核心定义 | 比价变动 = 独立买卖系统，与资金流向相关 |
| 体系定位 | 第72课 | 体系化 | 比价 = 三个独立系统之一 |
| 应用扩展 | 第73课 | 实践化 | 市场配置中的比价应用 |

---

## 定义

### 核心定义 [旧缠论]

**比价关系**：两个标的之间的价格比值关系。其变动构成独立的买卖系统，与市场资金流向相关。

### 比价K线 [旧缠论:隐含]

给定两个标的 A、B 的同周期 OHLCV 序列，比价K线定义为：

```
ratio_open  = A.open  / B.open
ratio_high  = A.high  / B.high
ratio_low   = A.low   / B.low
ratio_close = A.close / B.close
ratio_volume = A.volume
```

比价K线是标准 OHLCV 格式，可直接输入已有管线。

### 语义映射 [旧缠论:隐含]

比价K线上的缠论结构携带资本流转语义：

| 比价走势 | 资本流转含义 |
|---------|------------|
| 比价一笔向上 | 资本从 B 流向 A |
| 比价一笔向下 | 资本从 A 流向 B |
| 比价中枢 | A/B 之间资本流转暂时均衡 |
| 比价背驰 | 资本流转动力衰竭 |
| 比价走势完成 | 一段资本流转运动结束 |

### 不变量 [新缠论]

- **IR-1**（对称性）：A/B 比价上涨 ⟺ B/A 比价下跌
- **IR-2**（独立性）：比价走势独立于 A 或 B 各自的走势
- **IR-3**（完备性）：比价K线满足走势必完美（继承自已有管线）

---

## 当前实现

### 代码位置

- **比价K线构造**：`src/newchan/equivalence.py :: make_ratio_kline()`
- **历史接口**：`src/newchan/synthetic.py :: make_ratio()`（委托给 equivalence）
- **分析调度**：`src/newchan/ratio_engine.py :: analyze_pair()`
- **语义映射**：`src/newchan/capital_flow.py :: strokes_to_flows()`
- **CLI 入口**：`src/newchan/cli.py :: _cmd_synthetic --op ratio`

### 管线集成

比价K线直接输入标准管线，不需要修改任何已有模块：

```
make_ratio_kline(df_a, df_b)
  → merge_inclusion()
    → fractals_from_merged()
      → strokes_from_fractals()
        → segments_from_strokes_v1()
          → 比价走势结构
```

---

## 边界条件

- **B价格为0**：比价无意义，需过滤
- **时间对齐**：不同交易所需显式对齐策略
- **退化比价**：A/B 为常数时无走势结构（退化，不满足等价关系非退化条件）
- **翻转条件**：若比价K线数据量不足以产出分型（<3根合并K线），则无法分析

---

## 前置依赖

- **等价关系**（dengjia）：比价分析的前提是两个标的构成等价对
- **单标的定义集**（全部9个）：比价K线上运行完整的单标的语法

## 谱系引用

- `.chanlun/genealogy/settled/022-ratio-relation-formalization.md` — 本定义从此谱系中结算
- `.chanlun/genealogy/settled/020-constitutive-contradiction.md` — ontology-v1 命题5 是空间维度扩展的起点

---

## 影响声明

- **新增模块**：`.chanlun/definitions/bijia.md`（本文件）
- **关联定义**：`dengjia.md`（等价关系）
- **规范文件**：`docs/spec/ratio_relation_v1.md`
- **测试覆盖**：`test_ratio_pipeline.py`（4 E2E），`test_equivalence.py`（13），`test_ratio_engine.py`（15），`test_capital_flow.py`（18）

---

**更新日志**

- 2026-02-18: v1.0 /ritual 首次结算。第二阶段入口定义。
