# 等价关系（Dengjia / Equivalence Relation）

**版本**: v1.1
**状态**: 已结算
**最后更新**: 2026-02-18
**维度**: 跨标的（空间维度·筛选层）
**原文依据**: 第9课（隐含）
**规范文件**: `docs/spec/equivalence_relation_v1.md`
**定义编号**: #13

---

## 维度定位

等价关系与比价关系同属**跨标的维度**的基础概念，位于**筛选层**（L1）。

比价关系定义了"两个标的的价格比值如何分析"，等价关系定义了"什么条件下两个标的的比价系统值得看"。两者是同一维度上的互补定义：等价关系是比价关系的**筛选条件**（非本体关系）。

```
跨标的维度：
  L1 筛选层：等价关系（筛选条件）→ 比价K线（原子）→ 比价走势结构
              （本定义，#13）        （bijia 定义，#12）
  L2 拓扑层：流转关系（四矩阵有向流场）→ 共振检测 → 资本流转方向
              （liuzhuan 定义，#14）
```

> **本体论降格（025号谱系）**：缠师没有"等价关系"概念。缠师的操作方式是三独立系统——A、B、A/B 各自跑缠论，各自完备。C-1/C-2/C-3 不是"这两个标的是等价的"，而是"这个比价系统的走势结构是否有交易价值"。保留"等价"名称是沿用原文术语。

---

## 原文谱系

### 第9课 (2006-12-01) — 隐含前提

> "任何一个股票都不是独立的，在整个股票市场中，处在一定的比价关系中"

缠师在谈论比价时，隐含了一个前提：不是任意两个标的都有意义的比价关系。"处在一定的比价关系中"预设了可比较性。

### 溯源标注

等价关系的严格定义在原文中未独立出现。缠师使用"比价关系"时隐含了可比较性判断，但未将其作为独立概念形式化。本定义是 [新缠论] 首次形式化。

---

## 定义

### 等价对 [新缠论]

两个标的 A、B 构成**等价对**（equivalence pair），当且仅当满足三个条件：

1. **可比性**：A 和 B 有重叠的交易时间窗口（能构造对齐的K线序列）
2. **非退化**：A/B 比价不是常数（否则比价K线退化为平线，无走势结构）
3. **流动性**：A 和 B 都有充足的市场深度（否则比价反映的不是资本流转，而是流动性噪音）

### 数学性质

- **自反性**：不满足。A/A = 1（常数），违反非退化条件
- **对称性**：满足。A/B 可比 ⟺ B/A 可比
- **传递性**：不满足。A/B 有意义 + B/C 有意义 ≠ A/C 有意义

> 严格来说不是数学上的等价关系（不满足自反和传递）。保留"等价"名称是沿用原文术语。更准确的数学描述是"可比较关系"。

### 等价对分类 [新缠论]

| 类型 | 示例 | 特征 |
|------|------|------|
| 同行业竞品 | 可口可乐/百事 | 比价波动范围有限，中枢明确 |
| 替代品 | 黄金/白银 | 比价有长期趋势+区间 |
| 宏观资产类别 | 股票/债券（SPY/TLT） | 反映风险偏好变化 |
| 跨区域同品 | A股/H股同公司 | 反映资本管制和套利空间 |
| 四矩阵边 | 动产/不动产 | 反映宏观资本流转格局 |

---

## 当前实现

### 代码位置

- **数据结构**：`src/newchan/equivalence.py :: EquivalencePair`（frozen=True, slots=True）
- **验证逻辑**：`src/newchan/equivalence.py :: validate_pair()`
- **拓扑管理**：`src/newchan/matrix_topology.py :: MatrixEdge`（四矩阵边 = 等价对）

### 数据结构

```python
@dataclass(frozen=True, slots=True)
class EquivalencePair:
    sym_a: str
    sym_b: str
    category: str = ""
    @property
    def label(self) -> str:
        return f"{self.sym_a}/{self.sym_b}"
```

### 验证规则

`validate_pair(df_a, df_b)` 检查：
- 零价格过滤（B 价格为 0 → 比价无意义）
- 重叠时间窗口最小数量（默认 min_overlap=5）
- 非退化检查（比价标准差 < degeneracy_threshold → 常数退化）

---

## 四矩阵拓扑 [新缠论]

等价关系在四矩阵拓扑中的角色：4 个资本容器顶点（动产/不动产/商品/现金）构成 C(4,2)=6 条边，每条边是一个等价对。

详见：`src/newchan/matrix_topology.py`，`docs/spec/ratio_relation_v1.md` §3。

---

## 边界条件

- **翻转条件**：若去掉流动性条件，则低流动性标的也可构成等价对——但其比价走势携带的不是资本流转信号，而是噪音
- **极端情况**：
  - 停牌标的：交易时间窗口断裂，重叠不足 → 不满足可比性
  - ETF 与其成分股：可比但非独立（比价受申赎机制约束），需谨慎解读
  - 汇率类：A/B 即汇率本身，天然满足等价对条件

---

## 前置依赖

- 无（等价关系是比价关系的前置条件，本身不依赖其他定义）

## 后续依赖

- **比价关系**（bijia）：等价对成立后才能构造比价K线
- **四矩阵拓扑**：每条边是一个等价对
- **流转关系**（liuzhuan, #14）：在四矩阵上聚合多条边的方向，涌现资本流转信号

## 谱系引用

- `.chanlun/genealogy/settled/022-ratio-relation-formalization.md` — 本定义从此谱系中结算
- `.chanlun/genealogy/settled/020-constitutive-contradiction.md` — ontology-v1 命题5
- `.chanlun/genealogy/settled/025-equivalence-demotion-to-screening.md` — 降格为筛选条件

---

## 影响声明

- **新增模块**：`.chanlun/definitions/dengjia.md`（本文件）
- **关联定义**：`bijia.md`（比价关系）
- **规范文件**：`docs/spec/ratio_relation_v1.md` §2
- **测试覆盖**：`test_equivalence.py`（13），`test_matrix_topology.py`（28）

---

**更新日志**

- 2026-02-18: v1.0 /ritual 首次结算。等价关系形式化。
- 2026-02-18: v1.1 025号谱系决断。明确降格为筛选条件（非本体关系）。新增流转关系后续依赖。
