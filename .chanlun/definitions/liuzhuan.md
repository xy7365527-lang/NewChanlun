# 流转关系（Liuzhuan / Flow Relation）

**版本**: v1.0
**状态**: 已结算
**最后更新**: 2026-02-18
**维度**: 跨标的（空间维度·拓扑层）
**原文依据**: 第9课（"资金流向"推出）
**规范文件**: 待建（flow_relation_v1.md）
**定义编号**: #14

---

## 维度定位

流转关系是**跨标的维度**的拓扑层概念，位于等价关系（筛选层）之上。

```
跨标的维度：
  L1 筛选层：等价关系（C-1/C-2/C-3）→ "这对比价值不值得看"
  L1 原子层：比价K线 → 比价走势结构 → StrokeFlow（单边方向+力度）
  L2 拓扑层：流转关系（本定义）→ "资本正从哪个角流出、流向哪些角"
```

等价关系操作在 **pair-level**（一对一筛选），流转关系操作在 **topology-level**（四矩阵顶点聚合涌现）。两者在不同本体论层级上运作。

---

## 原文谱系

### 第9课 (2006-12-01) — 推出

> "比价关系的变动，也可以构成一个买卖系统，这个买卖系统是**和市场资金的流向相关的**"

"资金的流向"是缠师原文明确提到的概念。流转关系是将这一概念形式化为可计算的拓扑结构。

### 溯源标注

- "资金流向"：[旧缠论]（第9课原文）
- 比价走势携带资本流转语义：[旧缠论:隐含]（从"资金流向"推出）
- 四矩阵拓扑上的有向流场：[新缠论]（本定义首次形式化）
- 共振判定：[新缠论]
- 守恒约束：[新缠论]

---

## 定义

### 前置结构

- **四矩阵**：4 个资本容器顶点（动产/不动产/商品/现金）构成完全图 K₄，共 C(4,2)=6 条边
- **边方向**：每条边上有比价走势，当前笔的方向给出 `FlowDirection`（A→B / B→A / 均衡）
- **顶点**：`AssetVertex` 枚举（EQUITY / REAL_ESTATE / COMMODITY / CASH）

### 顶点流量 [新缠论]

对于顶点 V，令 E(V) = {e₁, e₂, e₃} 为其关联的 3 条边。每条边在当前走势阶段有一个方向（相对于 V）：

```
flow(eᵢ, V) = +1   资本流向 V（比价向 V 侧上涨）
             = -1   资本从 V 流出（比价向 V 侧下跌）
             =  0   均衡（比价中枢内）

net(V) = Σ flow(eᵢ, V)，i = 1..3
```

net(V) ∈ {-3, -2, -1, 0, +1, +2, +3}

### 共振判定 [新缠论]

```
|net(V)| ≥ 2  →  V 处于共振状态
                  net(V) ≤ -2 → V 是流转源（资本从 V 流出）
                  net(V) ≥ +2 → V 是流转汇（资本流入 V）

|net(V)| = 3  →  强共振（V 的全部 3 条边同向）
|net(V)| = 2  →  弱共振（V 的 2 条边同向，1 条反向或均衡）
|net(V)| ≤ 1  →  无共振（V 处无明确流转方向）
```

### 流转关系 [新缠论]

当顶点 V 为流转源（net(V) ≤ -2），且顶点 W₁, W₂, ... 为流转汇（net(Wᵢ) ≥ +2）时，存在流转关系：

```
Flow(V → {W₁, W₂, ...})
```

这是一个**有向、一对多**的关系，从源顶点到一个或多个汇顶点。

### 数学性质

| 性质 | 成立？ | 原因 |
|------|--------|------|
| 自反性 | ✗ | V 不能向自己流转 |
| 对称性 | ✗ | V→W 通常蕴含 ¬(W→V)（源和汇互斥） |
| 传递性 | ✗ | 无意义——流转关系不是 pair-level 的 |

### 守恒约束 [新缠论]

```
Σ net(V) = 0，对四矩阵中所有顶点 V 求和
```

这不是数学约定，是**"资本不凭空产生也不凭空消失"**的形式表达。

**守恒破缺的信号意义**：如果六条边计算出的 net flow 不守恒，说明：
- 某条边的走势判读有误，或
- 资本流向了四矩阵之外（跨区域流动——资本从一个经济体的四矩阵流向另一个）

守恒破缺本身就是信号，不是错误。

### 结构性同步 [新缠论]

6 条边的笔结构**不同步**——边 A/B 可能在第 5 笔，边 A/C 在第 3 笔。共振判定用的是**每条边自己的当前走势阶段**，不是固定时间窗口。

这与缠论的级别自相似性完全一致——不同边上的走势各自有各自的级别和节奏。共振是结构性的同步，不是时钟性的同步。

---

## 当前实现

### 已有基础设施

| 模块 | 功能 | 在流转关系中的角色 |
|------|------|-----------------|
| `capital_flow.py :: FlowDirection` | 单边方向枚举 | 流场的输入值域 |
| `capital_flow.py :: StrokeFlow` | 单笔方向+力度 | 流场的输入数据 |
| `capital_flow.py :: strokes_to_flows()` | 笔→流转映射 | 每条边的方向序列 |
| `matrix_topology.py :: AssetVertex` | 4 个顶点 | 流量聚合点 |
| `matrix_topology.py :: MatrixEdge` | 6 条边 | 流场骨架 |
| `matrix_topology.py :: FourMatrix` | 拓扑容器 | 流场载体 |

### 待实现

| 模块 | 功能 | 优先级 |
|------|------|--------|
| `flow_relation.py` | 顶点聚合 + 共振检测 + 流转状态 | P1 |
| `flow_relation.py :: VertexFlowState` | 顶点流转状态（源/汇/中性） | P1 |
| `flow_relation.py :: detect_resonance()` | 共振判定 | P1 |
| `flow_relation.py :: check_conservation()` | 守恒约束检查 | P2 |

---

## 边界条件

- **翻转条件**：如果将共振阈值从 |net|≥2 降为 |net|≥1，则几乎所有状态都是"共振"——概念退化为无区分力
- **极端状态**：|net|=3 对所有顶点可能对应系统性危机（如 2008 年——资本从所有风险资产同时撤出到现金）
- **区域维度**：四矩阵在每个经济体独立存在。跨经济体的流转关系需要两个四矩阵之间的映射（当前不在范围内）
- **边方向不确定**：当某条边处于中枢内（均衡态），flow(e, V)=0，该边不参与共振判定。极端情况下 3 条边全在中枢内 → net=0 → 无流转信号

---

## 前置依赖

- **比价关系**（bijia）：比价K线是流转关系的数据输入
- **等价关系**（dengjia）：筛选出值得看的比价系统（虽然四矩阵的 6 条边默认有效）
- **四矩阵拓扑**：流转关系的拓扑载体

## 后续依赖

- 无（当前为最高层概念）

## 谱系引用

- `.chanlun/genealogy/settled/025-equivalence-demotion-to-screening.md` — 本定义从此谱系中诞生
- `.chanlun/genealogy/settled/022-ratio-relation-formalization.md` — 比价关系（前置）
- `.chanlun/genealogy/settled/020-constitutive-contradiction.md` — ontology-v1 命题5

---

## 影响声明

- **新增定义**：`.chanlun/definitions/liuzhuan.md`（本文件，#14）
- **关联定义**：`dengjia.md`（#13，降格为筛选条件）、`bijia.md`（#12）
- **关联规范**：`docs/spec/ratio_relation_v1.md`（四矩阵拓扑）
- **待建规范**：`docs/spec/flow_relation_v1.md`
- **待建实现**：`src/newchan/flow_relation.py`

---

**更新日志**

- 2026-02-18: v1.0 编排者决断 → 新定义。流转关系 = 四矩阵上的有向流场。
