# 中枢（Zhongshu / Center / 走势中枢）

**版本**: v1.0
**状态**: 生成态
**最后更新**: 2026-02-15
**原文依据**: 第17课、第20课、第49课

---

## 原文谱系

中枢概念在缠师108课中的演化：

### 第17课 (2006-12-18) — 首次定义

> "为了深入研究这复杂问题，必须先引入缠中说禅走势中枢的概念：某级别走势类型中，被至少三个连续次级别走势类型所重叠的部分，称为缠中说禅走势中枢。换言之，缠中说禅走势中枢就是至少三个连续次级别走势类型重叠部分所构成。"
>
> "这里有一个递归的问题，就是这次级别不能无限下去，就像有些半吊子哲学胡诌什么'一分为二'，而'分'不是无限的，按照量子力学，物质之分是有极限的，同样，级别之次也不可能无限，在实际之中，对最后不能分解的级别，其缠中说禅走势中枢就不能用'至少三个连续次级别走势类型所重叠'定义，而定义为至少三个该级别单位K线重叠部分。一般来说，对实际操作，都把这最低的不可分解级别设定为1分钟或5分钟线，当然，也可以设定为1秒种线，但这都没有太大区别。"
>
> — 第17课 正文

**要点**：
- 核心定义：某级别走势类型中，至少三个连续次级别走势类型所重叠的部分
- 递归终止：最低级别（一般为1分钟）用三根K线重叠定义中枢
- 三个关键词：**三个、连续、次级别、重叠**

**课间答疑**：
> 缠中说禅2006-12-18 16:27:44
> "A段经过8元到18元，B段经过18元到12元，C段经过12元到24元，你说这ABC三段的重叠部分在什么地方？如果这都回答不出来，本ID也没办法了，因为这幼儿园的小朋友都能回答。"
> — 解释重叠即交集区间[12, 18]

> 缠中说禅2006-12-18 16:34:32
> "例子，580991：在11月8日到11月28日，构成0.677到0.803的中枢。一看就明白，看图明白才是真明白。"
> — 强调实盘识别

> 缠中说禅2006-12-19 12:48:27
> "什么叫至少？如果一万年在一个区间里，那还是一个中枢。"
> — 强调中枢延伸可无限持续

### 第20课 (2007-01-05) — 数学公式化与中心定理

> "缠中说禅走势中枢由前三个连续次级别走势类型的重叠部分确定，其后的走势有两种情况：
>
> 一、该走势中枢的延伸。
>
> 二、产生新的同级别走势中枢。"
>
> — 第20课 正文

**Z走势段与中枢区间数学定义**：
> "为方便起见，以后都把这些与中枢方向一致的次级别走势类型称为Z走势段，按中枢中的时间顺序，分别记为Zn等，而相应的高、低点分别记为gn、dn,定义四个指标：
>
> - GG = max(gn)
> - G = min(gn)
> - D = max(dn)
> - DD = min(dn)
>
> n遍历中枢中所有Zn。
>
> 特别地，再定义 ZG = min(g1、g2), ZD = max(d1、d2)，显然，[ZD，ZG]就是缠中说禅走势中枢的区间。"
>
> — 第20课 数学公式段

**中心定理一（延伸判定）**：
> "缠中说禅走势中枢中心定理一：走势中枢的延伸等价于任意区间[dn，gn]与[ZD，ZG]有重叠。换言之，若有Zn，使得dn>ZG或gn<ZD，则必然产生高级别的走势中枢或趋势及延续。"

**中心定理二（两中枢关系）**：
> "缠中说禅走势中枢中心定理二：前后同级别的两个缠中说禅走势中枢，后GG<前DD，等价于下跌及其延续；后DD>前GG等价于上涨及其延续。后ZG<前ZD且后GG>=前DD，或后ZD>前ZG且后DD=<前GG，则等价于形成高级别的走势中枢。"

**级别延续定理**：
> "缠中说禅走势级别延续定理一：在更大级别缠中说禅走势中枢产生前，该级别走势类型将延续。也就是说，只能是只具有该级别缠中说禅走势中枢的盘整或趋势的延续。"
>
> "缠中说禅走势级别延续定理二：更大级别缠中说禅走势中枢产生，当且仅当围绕连续两个同级别缠中说禅走势中枢产生的波动区间产生重叠。"

**课间答疑**：
> 缠中说禅2007-01-05 16:52:13
> "各位不要把东西混了，中枢的离开返回是针对围绕中枢的运动说的，这里研究的是中枢自身的变化，也就是中枢延续与产生新中枢以及产生更高级别的中枢这三种情况的问题。三种情况，有最严格的定义，把这些情况给搞清楚，然后多看图去印证。"

> 缠中说禅2006-12-25 21:23:36
> "走势类型A、B、C，分别的高、低点是a1\a2,b1\b2,c1\c2。则，中枢的区间就是（max（a2,b2,c2)，min（a1,b1,c1))。其实，实际上用目测就可以，不用这么复杂。"

### 第49课 (2007-03-22) — 中枢三态

> "对任何级别的走势中枢，无非有三种情况：
>
> 1. 当下在该中枢之中 (ZG-ZD)。
> 2. 当下在该中枢之下（小于ZD)。
> 3. 当下在该中枢之上（大于ZG)。"
>
> — 第49课 正文

### 谱系小结

| 阶段 | 课号 | 性质 | 关键内容 |
|------|------|------|---------|
| 核心定义 | 第17课 | 公理定义 | 至少三个连续次级别走势类型重叠 |
| 数学化 | 第20课 | 形式化 | ZG/ZD/GG/DD，中心定理一/二 |
| 操作化 | 第49课 | 实践准则 | 中枢三态（之中/之下/之上）|

---

## 定义

### 核心定义（第17课）

**中枢（Zhongshu / Center）**：某级别走势类型中，被至少三个连续次级别走势类型所重叠的部分，称为缠中说禅走势中枢。

**递归终止**：最低级别（通常为1分钟）的中枢由该级别三根K线重叠部分构成。

### 数学表达（第20课）

设某级别中枢由连续三个次级别走势类型 A、B、C 构成，其高低点分别为 (a1, a2)、(b1, b2)、(c1, c2)，则：

**中枢区间公式**：
```
[ZD, ZG] = [max(a2, b2, c2), min(a1, b1, c1)]
```

**简化公式**（针对回升/回调形成的中枢）：
```
[ZD, ZG] = [max(a2, c2), min(a1, c1)]
```

**Z走势段指标**（Z1, Z2, ..., Zn 为与中枢形成方向一致的次级别走势类型）：
- ZG = min(g1, g2)  （前两个Z走势段高点的较小值）
- ZD = max(d1, d2)  （前两个Z走势段低点的较大值）
- GG = max(g1, g2, ..., gn)  （所有Z走势段高点的最大值）
- G = min(g1, g2, ..., gn)   （所有Z走势段高点的最小值）
- DD = min(d1, d2, ..., dn)  （所有Z走势段低点的最小值）
- D = max(d1, d2, ..., dn)   （所有Z走势段低点的最大值）

### 成立条件

**必要条件**：
1. 至少三个连续次级别走势类型
2. 这三个走势类型必须有价格区间重叠（即 ZG > ZD 严格成立）
3. 次级别走势类型必须是已完成的（confirmed=True）

**充分条件**：
满足上述必要条件即可确认中枢成立。

---

## 中枢三种发展（第20课）

### 1. 延伸（Extension）

**定义**：后续Z走势段 Zn 的区间 [dn, gn] 与中枢区间 [ZD, ZG] 有重叠。

**判定条件**（中心定理一）：
```
延伸 ⟺ 任意 Zn 满足 [dn, gn] ∩ [ZD, ZG] ≠ ∅
```

**反之**（必然产生高级别中枢或趋势）：
```
若存在 Zn 使得 dn > ZG 或 gn < ZD → 中枢终结
```

**特性**：
- 延伸可无限持续（如涨停板持续封死）
- 延伸时 [ZD, ZG] 区间保持不变（由前三段确定）
- 表现为盘整震荡

### 2. 新生（Newborn / 趋势延续）

**定义**：产生新的同级别走势中枢，且新中枢与前中枢无波动区间重叠。

**判定条件**（中心定理二）：
- 上涨趋势延续：后 DD > 前 GG
- 下跌趋势延续：后 GG < 前 DD

**特性**：
- 同级别前后中枢的 [ZD, ZG] 区间不重叠
- 构成趋势（至少两个同向中枢）
- 连接中枢的必然是次级别以下走势

### 3. 扩展（Expansion / 升级成高级别中枢）

**定义**：新产生的同级别中枢的波动区间与前中枢的波动区间产生重叠，形成更高级别中枢。

**判定条件**（中心定理二）：
```
高级别中枢 ⟺ (后ZG < 前ZD 且 后GG >= 前DD) 或
              (后ZD > 前ZG 且 后DD <= 前GG)
```

**特性**：
- 本级别中将两个中枢视为一个（合并）
- 需在更高级别分析
- 理论可无限向上扩展

---

## 当前实现

### 代码位置

- **主算法**：`src/newchan/a_zhongshu_v1.py`
  - `zhongshu_from_segments(segments: list[Segment]) -> list[Zhongshu]`
  - 采用固定区间法：前三段确定 [ZD, ZG]，后续段只判延伸不改区间

- **事件引擎**：`src/newchan/core/recursion/zhongshu_engine.py`
  - `ZhongshuEngine.process_segment_snapshot(seg_snap) -> ZhongshuSnapshot`
  - 与 BiEngine、SegmentEngine 三层同构

- **审计检查**：`src/newchan/audit/zhongshu_checker.py`
  - `check_zhongshu_definition(zhongshu, segments)` — 验证三段重叠定义
  - `check_zhongshu_identity(zhongshu)` — 验证确定性 ID

- **状态管理**：`src/newchan/core/recursion/zhongshu_state.py`
  - `ZhongshuSnapshot` — 中枢快照
  - `diff_zhongshu()` — 中枢 diff 事件

### 实现特点

1. **只处理已确认段**：`confirmed=True` 的 Segment
2. **固定区间法**：[ZD, ZG] 由初始三段确定后不再变化
3. **续进机制**：突破后从 `break_seg_idx - 2` 开始扫描下一个中枢
4. **确定性 ID**：每个中枢有唯一标识符，便于事件溯源

### 数据结构（Zhongshu）

```python
@dataclass(frozen=True)
class Zhongshu:
    zd: float              # 中枢下沿
    zg: float              # 中枢上沿
    seg_start: int         # 第一段索引
    seg_end: int           # 最后包含段索引（含延伸）
    seg_count: int         # 构成段数 (>= 3)
    settled: bool          # 是否已被突破闭合
    break_seg: int         # 突破段索引（-1=未闭合）
    break_direction: str   # "up" / "down" / ""
    first_seg_s0: int      # 第一段起点笔索引
    last_seg_s1: int       # 最后段终点笔索引
```

---

## 边界条件

### 最小级别递归终止

- 当级别无法再向下分解时（通常为1分钟K线），中枢由三根K线重叠定义
- 实际操作常设定1分钟或5分钟为最低级别

### 极端情况

1. **涨停板封死**：
   - 持续涨停只形成1分钟级别中枢延伸
   - 无论封多少天，都不构成更高级别中枢（除非打开涨停）

2. **庄股极端操控**：
   - 每天只成交一次，价位相同
   - 只形成1分钟中枢，无法形成更大级别中枢

3. **中枢延伸无限**：
   - 理论上一个区间可震荡一万年
   - 只要后续波动与 [ZD, ZG] 有重叠，就是延伸

### ZG > ZD 严格性

- 三个连续次级别走势类型的重叠区间必须严格满足 ZG > ZD
- 若 ZG <= ZD，则三段无公共重叠，不构成中枢

### 级别递归约束

- 本级别中枢 = 次级别走势类型（需至少3段次级别）
- 次级别走势类型 = 次次级别中枢（需至少1个中枢）
- 递归链：1分K线 → 笔 → 线段 → 次级别走势类型 → 中枢

---

## 未结算问题

### 1. 中枢区间动态更新 vs 固定区间

**原文表述**（第20课）：
> "ZG = min(g1, g2), ZD = max(d1, d2)"

**未明确**：
- 是否只用前两个Z走势段确定 [ZD, ZG] 后固定不变？
- 还是随延伸段动态更新（如 `ZG = min(g1, g2, ..., gn)`）？

**当前实现选择**：
- v1 采用固定区间法（前三段确定后不变）
- 优点：稳定、确定性强
- 缺点：延伸段可能突破初始区间但仍判定为"延伸"

**后续计划**：
- 待与原文严格对照后决定是否需要 v2 动态区间版本

### 2. 中枢扩展的充要条件

**中心定理二原文**：
> "后ZG<前ZD且后GG>=前DD，或后ZD>前ZG且后DD=<前GG，则等价于形成高级别的走势中枢。"

**未明确**：
- 这是充分条件还是充要条件？
- 实际图形中是否存在其他扩展路径？

**当前理解**：
- 暂时视为充要条件
- 需更多实盘验证

### 3. "笔不裁决"与中枢组件

**原文隐含规则**：
- 中枢组件必须是次级别走势类型（至少包含一个次级别中枢）
- 单纯的笔不能作为中枢组件（"笔不裁决"）

**未完全明确**：
- 若笔段满足"三段重叠"，为何不能构成中枢？
- 原文未给出明确推导，可能与"走势必完美"相关

**当前实现**：
- `definitions.yaml` 中明确标注 `禁止 Stroke(笔不裁决)`
- 中枢组件必须是 Segment（线段）

---

## 定理汇总

### 基本原理

1. **技术分析基本原理二**（第17课）：
   任何级别任何完成的走势类型，必然包含一个以上的缠中说禅走势中枢。

2. **走势分解定理二**（第17课）：
   任何级别的任何走势类型，都至少由三段以上次级别走势类型构成。

### 中枢定理

3. **中心定理一**（第20课）：
   走势中枢的延伸等价于任意区间[dn，gn]与[ZD，ZG]有重叠。换言之，若有Zn，使得dn>ZG或gn<ZD，则必然产生高级别的走势中枢或趋势及延续。

4. **中心定理二**（第20课）：
   前后同级别的两个缠中说禅走势中枢，后GG<前DD等价于下跌及其延续；后DD>前GG等价于上涨及其延续。后ZG<前ZD且后GG>=前DD，或后ZD>前ZG且后DD=<前GG，则等价于形成高级别的走势中枢。

5. **级别延续定理一**（第20课）：
   在更大级别缠中说禅走势中枢产生前，该级别走势类型将延续。

6. **级别延续定理二**（第20课）：
   更大级别缠中说禅走势中枢产生，当且仅当围绕连续两个同级别缠中说禅走势中枢产生的波动区间产生重叠。

7. **中枢终结定理**（第17课，缠论知识库）：
   某级别中枢终结，当且仅当一个次级别走势离开该中枢后，其后的次级别回抽走势不重新回到该中枢内。

---

## 谱系引用

### 相关定义依赖

- **前置依赖**：线段（Segment）— 中枢组件必须是已确认线段
- **底层依赖**：笔（Stroke）→ 线段 → 走势类型 → 中枢
- **相关定义**：
  - 走势类型（TrendType）：盘整（1个中枢）、趋势（≥2个同向中枢）
  - 买卖点（BuySellPoint）：第三类买卖点定义依赖中枢 ZG/ZD

### 相关谱系记录

- `.chanlun/genealogy/pending/001-degenerate-segment.md` — 退化段问题（可能影响中枢识别）
- `.chanlun/genealogy/pending/002-source-incompleteness.md` — 原文缺失课程（第67、71、78课线段标准对中枢有间接影响）

---

## 影响声明

### 直接影响

- **走势类型分类**：盘整 vs 趋势的判定完全依赖中枢数量和方向
- **买卖点识别**：第三类买卖点需 ZG/ZD 边界判定
- **级别递归**：中枢是级别向上构造的核心单元

### 间接影响

- **背驰判断**：A+B+C 结构中 B 段通常是中枢/盘整
- **操作决策**：中枢引力、震荡区间、支撑压力位均源于中枢

### 测试要求

- **定义检查**：`check_zhongshu_definition()` 验证三段重叠成立
- **确定性 ID**：`check_zhongshu_identity()` 保证可溯源
- **覆盖率例外**：本模块受"生成态例外"约束（见 `.claude/rules/testing-override.md`）
  - 若测试失败暴露定义冲突 → 矛盾上浮流程
  - 不可通过修改实现来让测试通过

---

## 六要素结果包

### 1. 结论

中枢（Zhongshu）是缠论体系中最基础的概念之一，定义为"某级别走势类型中，被至少三个连续次级别走势类型所重叠的部分"。当前实现 `a_zhongshu_v1.py` 采用固定区间法，由初始三段确定 [ZD, ZG]，后续段仅判延伸不改区间。

### 2. 定义依据

- **原文权威**：第17课（首次定义）、第20课（数学公式化）、第49课（三态操作）
- **知识库**：`缠论知识库.md` § 6 走势中枢
- **实体定义**：`definitions.yaml` entities[5] — 中枢
- **输入特征满足条件**：
  - 输入为 `list[Segment]`，过滤 `confirmed=True`
  - 连续三段满足 `max(lows) < min(highs)` → 三段重叠成立 → 中枢构成

### 3. 边界条件

- **翻转条件**：
  - 若 `ZG <= ZD` → 三段无公共重叠 → 不构成中枢
  - 若后续段 `dn > ZG` 或 `gn < ZD` → 延伸终止 → 中枢闭合
- **极端情况**：
  - 涨停封死 → 只能形成1分钟级别中枢延伸
  - 庄股日成交一次 → 无法形成更大级别中枢
- **下游质询点**：
  - ZG/ZD 是固定还是动态？（当前 v1 选固定）
  - 中枢扩展判定的充要性？（待验证）

### 4. 下游推论

若当前中枢定义成立，则：

1. **级别递归可行**：1分K线 → 笔 → 线段 → 走势类型 → 中枢 → 更高级别中枢
2. **走势类型唯一分类**：任何完成走势必有 ≥1 个中枢（盘整=1个，趋势≥2个）
3. **买卖点可定位**：第三类买卖点由 ZG/ZD 边界精确界定
4. **操作策略可验证**：中枢震荡、第三类买卖点均可回测验证

### 5. 谱系引用

- **已知矛盾**：无（中枢定义在原文中较为稳定，未见明显修订）
- **相关谱系**：
  - `001-degenerate-segment.md` — 退化段可能影响中枢识别准确性
  - `002-source-incompleteness.md` — 线段标准变化可能间接影响中枢组件
- **权威链依赖**：第17课（一级权威，博文原文）> 第20课（数学公式化）> 缠论知识库（三级，总结）

### 6. 影响声明

- **新增模块**：`.chanlun/definitions/zhongshu.md`（本文件）
- **已有模块**：
  - `a_zhongshu_v1.py` — 实现层（已存在，本文档化其定义依据）
  - `definitions.yaml` — entities[5] 中枢条目
  - `缠论知识库.md` — § 6 走势中枢
- **测试影响**：
  - 中枢相关测试（`test_zhongshu_*.py`）受生成态例外约束
  - 若测试失败揭示定义冲突 → 不修改实现，而是走矛盾上浮流程
- **文档新增**：本定义文件为谱系体系重要组成部分

---

**更新日志**

- 2026-02-15: v1.0 初始版本，基于第17课、第20课、第49课原文及当前 v1 实现整理
