# 中枢（Zhongshu / Center / 走势中枢）

**版本**: v1.3
**状态**: 已结算
**最后更新**: 2026-02-16
**原文依据**: 第17课、第20课、第49课

---

## 原文谱系

中枢概念在缠师108课中的演化：

### 第17课 (2006-12-18) — 首次定义

> "为了深入研究这复杂问题，必须先引入缠中说禅走势中枢的概念：某级别走势类型中，被至少三个连续次级别走势类型所重叠的部分，称为缠中说禅走势中枢。换言之，缠中说禅走势中枢就是至少三个连续次级别走势类型重叠部分所构成。"
>
> "这里有一个递归的问题，就是这次级别不能无限下去，就像有些半吊子哲学胡诌什么'一分为二'，而'分'不是无限的，按照量子力学，物质之分是有极限的，同样，级别之次也不可能无限，在实际之中，对最后不能分解的级别，其缠中说禅走势中枢就不能用'至少三个连续次级别走势类型所重叠'定义，而定义为至少三个该级别单位K线重叠部分。一般来说，对实际操作，都把这最低的不可分解级别设定为1分钟或5分钟线，当然，也可以设定为1秒种线，但这都没有太大区别。"
>
> — 第17课 正文

**要点**：
- 核心定义：某级别走势类型中，至少三个连续次级别走势类型所重叠的部分
- 递归终止：最低级别（一般为1分钟）用三根K线重叠定义中枢
- 三个关键词：**三个、连续、次级别、重叠**

**课间答疑**：
> 缠中说禅2006-12-18 16:27:44
> "A段经过8元到18元，B段经过18元到12元，C段经过12元到24元，你说这ABC三段的重叠部分在什么地方？如果这都回答不出来，本ID也没办法了，因为这幼儿园的小朋友都能回答。"
> — 解释重叠即交集区间[12, 18]

> 缠中说禅2006-12-18 16:34:32
> "例子，580991：在11月8日到11月28日，构成0.677到0.803的中枢。一看就明白，看图明白才是真明白。"
> — 强调实盘识别

> 缠中说禅2006-12-19 12:48:27
> "什么叫至少？如果一万年在一个区间里，那还是一个中枢。"
> — 强调中枢延伸可无限持续

### 第20课 (2007-01-05) — 数学公式化与中心定理

> "缠中说禅走势中枢由前三个连续次级别走势类型的重叠部分确定，其后的走势有两种情况：
>
> 一、该走势中枢的延伸。
>
> 二、产生新的同级别走势中枢。"
>
> — 第20课 正文

**Z走势段与中枢区间数学定义**：
> "为方便起见，以后都把这些与中枢方向一致的次级别走势类型称为Z走势段，按中枢中的时间顺序，分别记为Zn等，而相应的高、低点分别记为gn、dn,定义四个指标：
>
> - GG = max(gn)
> - G = min(gn)
> - D = max(dn)
> - DD = min(dn)
>
> n遍历中枢中所有Zn。
>
> 特别地，再定义 ZG = min(g1、g2), ZD = max(d1、d2)，显然，[ZD，ZG]就是缠中说禅走势中枢的区间。"
>
> — 第20课 数学公式段

**中心定理一（延伸判定）**：
> "缠中说禅走势中枢中心定理一：走势中枢的延伸等价于任意区间[dn，gn]与[ZD，ZG]有重叠。换言之，若有Zn，使得dn>ZG或gn<ZD，则必然产生高级别的走势中枢或趋势及延续。"

**中心定理二（两中枢关系）**：
> "缠中说禅走势中枢中心定理二：前后同级别的两个缠中说禅走势中枢，后GG<前DD，等价于下跌及其延续；后DD>前GG等价于上涨及其延续。后ZG<前ZD且后GG>=前DD，或后ZD>前ZG且后DD=<前GG，则等价于形成高级别的走势中枢。"

**级别延续定理**：
> "缠中说禅走势级别延续定理一：在更大级别缠中说禅走势中枢产生前，该级别走势类型将延续。也就是说，只能是只具有该级别缠中说禅走势中枢的盘整或趋势的延续。"
>
> "缠中说禅走势级别延续定理二：更大级别缠中说禅走势中枢产生，当且仅当围绕连续两个同级别缠中说禅走势中枢产生的波动区间产生重叠。"

**课间答疑**：
> 缠中说禅2007-01-05 16:52:13
> "各位不要把东西混了，中枢的离开返回是针对围绕中枢的运动说的，这里研究的是中枢自身的变化，也就是中枢延续与产生新中枢以及产生更高级别的中枢这三种情况的问题。三种情况，有最严格的定义，把这些情况给搞清楚，然后多看图去印证。"

> 缠中说禅2006-12-25 21:23:36
> "走势类型A、B、C，分别的高、低点是a1\a2,b1\b2,c1\c2。则，中枢的区间就是（max（a2,b2,c2)，min（a1,b1,c1))。其实，实际上用目测就可以，不用这么复杂。"

### 第49课 (2007-03-22) — 中枢三态

> "对任何级别的走势中枢，无非有三种情况：
>
> 1. 当下在该中枢之中 (ZG-ZD)。
> 2. 当下在该中枢之下（小于ZD)。
> 3. 当下在该中枢之上（大于ZG)。"
>
> — 第49课 正文

### 谱系小结

| 阶段 | 课号 | 性质 | 关键内容 |
|------|------|------|---------|
| 核心定义 | 第17课 | 公理定义 | 至少三个连续次级别走势类型重叠 |
| 数学化 | 第20课 | 形式化 | ZG/ZD/GG/DD，中心定理一/二 |
| 操作化 | 第49课 | 实践准则 | 中枢三态（之中/之下/之上）|

---

## 定义

### 核心定义（第17课）

**中枢（Zhongshu / Center）**：某级别走势类型中，被至少三个连续次级别走势类型所重叠的部分，称为缠中说禅走势中枢。

**递归终止**：最低级别（通常为1分钟）的中枢由该级别三根K线重叠部分构成。

### 数学表达（第20课）

设某级别中枢由连续三个次级别走势类型 A、B、C 构成，其高低点分别为 (a1, a2)、(b1, b2)、(c1, c2)，则：

**中枢区间公式**：
```
[ZD, ZG] = [max(a2, b2, c2), min(a1, b1, c1)]
```

**简化公式**（针对回升/回调形成的中枢）：
```
[ZD, ZG] = [max(a2, c2), min(a1, c1)]
```

**Z走势段指标**（Z1, Z2, ..., Zn 为与中枢形成方向一致的次级别走势类型）：
- ZG = min(g1, g2)  （前两个Z走势段高点的较小值）
- ZD = max(d1, d2)  （前两个Z走势段低点的较大值）
- GG = max(g1, g2, ..., gn)  （所有Z走势段高点的最大值）
- G = min(g1, g2, ..., gn)   （所有Z走势段高点的最小值）
- DD = min(d1, d2, ..., dn)  （所有Z走势段低点的最小值）
- D = max(d1, d2, ..., dn)   （所有Z走势段低点的最大值）

### 成立条件

**必要条件**：
1. 至少三个连续次级别走势类型
2. 这三个走势类型必须有价格区间重叠（即 ZG > ZD 严格成立）
3. 次级别走势类型必须是已完成的（confirmed=True）

**充分条件**：
满足上述必要条件即可确认中枢成立。

---

## 中枢三种发展（第20课）

### 1. 延伸（Extension）

**定义**：后续Z走势段 Zn 的区间 [dn, gn] 与中枢区间 [ZD, ZG] 有重叠。

**判定条件**（中心定理一）：
```
延伸 ⟺ 任意 Zn 满足 [dn, gn] ∩ [ZD, ZG] ≠ ∅
```

**反之**（必然产生高级别中枢或趋势）：
```
若存在 Zn 使得 dn > ZG 或 gn < ZD → 中枢终结
```

**特性**：
- 延伸可无限持续（如涨停板持续封死）
- 延伸时 [ZD, ZG] 区间保持不变（由前三段确定）
- 表现为盘整震荡

### 2. 新生（Newborn / 趋势延续）

**定义**：产生新的同级别走势中枢，且新中枢与前中枢无波动区间重叠。

**判定条件**（中心定理二）：
- 上涨趋势延续：后 DD > 前 GG
- 下跌趋势延续：后 GG < 前 DD

**特性**：
- 同级别前后中枢的 [ZD, ZG] 区间不重叠
- 构成趋势（至少两个同向中枢）
- 连接中枢的必然是次级别以下走势

### 3. 扩展（Expansion / 升级成高级别中枢）

**定义**：新产生的同级别中枢的波动区间与前中枢的波动区间产生重叠，形成更高级别中枢。

**判定条件**（中心定理二）：
```
高级别中枢 ⟺ (后ZG < 前ZD 且 后GG >= 前DD) 或
              (后ZD > 前ZG 且 后DD <= 前GG)
```

**特性**：
- 本级别中将两个中枢视为一个（合并）
- 需在更高级别分析
- 理论可无限向上扩展

---

## 当前实现

### 代码位置

- **主算法**：`src/newchan/a_zhongshu_v1.py`
  - `zhongshu_from_segments(segments: list[Segment]) -> list[Zhongshu]`
  - 采用固定区间法：前三段确定 [ZD, ZG]，后续段只判延伸不改区间

- **事件引擎**：`src/newchan/core/recursion/zhongshu_engine.py`
  - `ZhongshuEngine.process_segment_snapshot(seg_snap) -> ZhongshuSnapshot`
  - 与 BiEngine、SegmentEngine 三层同构

- **审计检查**：`src/newchan/audit/zhongshu_checker.py`
  - `check_zhongshu_definition(zhongshu, segments)` — 验证三段重叠定义
  - `check_zhongshu_identity(zhongshu)` — 验证确定性 ID

- **状态管理**：`src/newchan/core/recursion/zhongshu_state.py`
  - `ZhongshuSnapshot` — 中枢快照
  - `diff_zhongshu()` — 中枢 diff 事件

### 实现特点

1. **只处理已确认段**：`confirmed=True` 的 Segment
2. **固定区间法**：[ZD, ZG] 由初始三段确定后不再变化
3. **续进机制**：突破后从 `break_seg_idx - 2` 开始扫描下一个中枢
4. **确定性 ID**：每个中枢有唯一标识符，便于事件溯源

### 数据结构（Zhongshu）

```python
@dataclass(frozen=True)
class Zhongshu:
    zd: float              # 中枢下沿
    zg: float              # 中枢上沿
    seg_start: int         # 第一段索引
    seg_end: int           # 最后包含段索引（含延伸）
    seg_count: int         # 构成段数 (>= 3)
    settled: bool          # 是否已被突破闭合
    break_seg: int         # 突破段索引（-1=未闭合）
    break_direction: str   # "up" / "down" / ""
    first_seg_s0: int      # 第一段起点笔索引
    last_seg_s1: int       # 最后段终点笔索引
```

---

## 边界条件

### 最小级别递归终止

- 当级别无法再向下分解时（通常为1分钟K线），中枢由三根K线重叠定义
- 实际操作常设定1分钟或5分钟为最低级别

### 极端情况

1. **涨停板封死**：
   - 持续涨停只形成1分钟级别中枢延伸
   - 无论封多少天，都不构成更高级别中枢（除非打开涨停）

2. **庄股极端操控**：
   - 每天只成交一次，价位相同
   - 只形成1分钟中枢，无法形成更大级别中枢

3. **中枢延伸无限**：
   - 理论上一个区间可震荡一万年
   - 只要后续波动与 [ZD, ZG] 有重叠，就是延伸

### ZG > ZD 严格性

- 三个连续次级别走势类型的重叠区间必须严格满足 ZG > ZD
- 若 ZG <= ZD，则三段无公共重叠，不构成中枢

### 级别递归约束

- 本级别中枢 = 次级别走势类型（需至少3段次级别）
- 次级别走势类型 = 次次级别中枢（需至少1个中枢）
- 递归链：1分K线 → 笔 → 线段 → 次级别走势类型 → 中枢

---

## 审计结果（v1.1, 2026-02-16）

### 审计检验表

| # | 检验点 | 状态 | 说明 |
|---|--------|------|------|
| 1 | 三段重叠 `ZG > ZD` | ✅ | `max(lows) < min(highs)` 严格不等，正确 |
| 2 | 延伸判定边界 | ✅ 已修复 | 原为 `>/<`（严格），已修正为 `>=/ <=`（弱不等式，匹配中心定理一） |
| 3 | 突破方向 | ✅ 已修复 | 联动修复：`>=/ <=` → `>/<`（突破后必为严格不等） |
| 4 | 续进策略 | ✅ | `max(break_idx-2, seg_end)` 合理 |
| 5 | diff 身份跳过 | ✅ | 同身份中枢延伸/闭合不产生 invalidate |
| 6 | 确定性 ID | ✅ | 同输入两次运行 event_id 完全一致 |

### 修复详情：延伸判定边界条件

**原文依据**（第20课中心定理一）：
> "走势中枢的延伸等价于任意区间[dn，gn]与[ZD，ZG]有重叠。
> 换言之，若有Zn，使得 **dn>ZG** 或 **gn<ZD**，则必然产生高级别的走势中枢或趋势及延续。"

**突破条件使用严格不等式**（`>` 和 `<`），因此延伸（突破的否定）应使用**弱不等式**（`<=` 和 `>=`）。

- **旧实现**：`sj.high > zd and sj.low < zg`（严格不等）
- **新实现**：`sj.high >= zd and sj.low <= zg`（弱不等式）
- **影响**：当段的 high 精确等于 ZD 或 low 精确等于 ZG 时，旧实现错误判定为突破；新实现正确判定为延伸（单点重叠）
- **突破方向联动**：`breaker.low >= zg` → `breaker.low > zg`，`breaker.high <= zd` → `breaker.high < zd`
- **新增测试**：5 个边界条件测试（`TestExtensionBoundaryTouch`），36/36 全绿

---

## 未结算问题

### ~~1. 中枢区间动态更新 vs 固定区间~~ → ✅ 已结算

**原文表述**（第20课）：
> "ZG = min(g1, g2), ZD = max(d1, d2)"

**结算结论**：**固定区间正确**。
- ZG/ZD 由初始 Z走势段（前两段同向走势）确定后不再变化
- 中心定理一明确用固定 [ZD, ZG] 判定延伸：`[dn, gn] ∩ [ZD, ZG] ≠ ∅`
- 延伸时 [ZD, ZG] 不变是原文本意，非实现简化
- v1 固定区间法与原文一致

### ~~2. 中枢扩展的充要条件~~ → ✅ 已结算

**中心定理二原文**：
> "后ZG<前ZD且后GG>=前DD，或后ZD>前ZG且后DD=<前GG，则**等价于**形成高级别的走势中枢。"

**结算结论**：**充要条件，原文严格推导，无歧义。** [旧缠论]
- 原文三次使用充要条件表述："等价于"、"必然要采取第三种方式"、"当且仅当"
- 中心定理一（延伸）与中心定理二（新生/扩展）构成完备三分类：延伸 ∪ 新生 ∪ 扩展 = 全集
- 扩展条件数学表达：`(后ZG < 前ZD ∧ 后GG ≥ 前DD) ∨ (后ZD > 前ZG ∧ 后DD ≤ 前GG)`
- **v1 实现选择** [旧缠论:选择]：`a_move_v1.py` 故意省略扩展逻辑（波动区间重叠时截断为不同 Move），定位为单级别管线。多级别中枢扩展留待递归引擎层处理。
- v0 `a_trendtype_v0.py` 的 `_centers_relation()` 包含 `"higher_center"` 分类判定，可作参照
- 不涉及 [新缠论]，原文定义无歧义

### ~~3. "笔不裁决"与中枢组件~~ → ✅ 已结算

**结算结论**：中枢组件必须是线段（次级别走势类型），笔不可作为中枢组件。
- 递归定义明确：中枢 = 至少三个连续**次级别走势类型**重叠
- 线段是第一递归层级的"次级别走势类型"，笔是结构元素非走势类型
- `definitions.yaml` 中 `禁止 Stroke(笔不裁决)` 正确
- 当前实现输入为 `list[Segment]`，与定义一致

---

## 定理汇总

### 基本原理

1. **技术分析基本原理二**（第17课）：
   任何级别任何完成的走势类型，必然包含一个以上的缠中说禅走势中枢。

2. **走势分解定理二**（第17课）：
   任何级别的任何走势类型，都至少由三段以上次级别走势类型构成。

### 中枢定理

3. **中心定理一**（第20课）：
   走势中枢的延伸等价于任意区间[dn，gn]与[ZD，ZG]有重叠。换言之，若有Zn，使得dn>ZG或gn<ZD，则必然产生高级别的走势中枢或趋势及延续。

4. **中心定理二**（第20课）：
   前后同级别的两个缠中说禅走势中枢，后GG<前DD等价于下跌及其延续；后DD>前GG等价于上涨及其延续。后ZG<前ZD且后GG>=前DD，或后ZD>前ZG且后DD=<前GG，则等价于形成高级别的走势中枢。

5. **级别延续定理一**（第20课）：
   在更大级别缠中说禅走势中枢产生前，该级别走势类型将延续。

6. **级别延续定理二**（第20课）：
   更大级别缠中说禅走势中枢产生，当且仅当围绕连续两个同级别缠中说禅走势中枢产生的波动区间产生重叠。

7. **中枢终结定理**（第17课，缠论知识库）：
   某级别中枢终结，当且仅当一个次级别走势离开该中枢后，其后的次级别回抽走势不重新回到该中枢内。

---

## 谱系引用

### 相关定义依赖

- **前置依赖**：线段（Segment）— 中枢组件必须是已确认线段
- **底层依赖**：笔（Stroke）→ 线段 → 走势类型 → 中枢
- **相关定义**：
  - 走势类型（TrendType）：盘整（1个中枢）、趋势（≥2个同向中枢）
  - 买卖点（BuySellPoint）：第三类买卖点定义依赖中枢 ZG/ZD

### 相关谱系记录

- `.chanlun/genealogy/settled/001-degenerate-segment.md` — 退化段问题（✅ 已结算，真实数据退化段率=0%）
- `.chanlun/genealogy/settled/002-source-incompleteness.md` — 原文缺失课程（第67、71、78课线段标准对中枢有间接影响）— ✅ 已结算

---

## 影响声明

### 直接影响

- **走势类型分类**：盘整 vs 趋势的判定完全依赖中枢数量和方向
- **买卖点识别**：第三类买卖点需 ZG/ZD 边界判定
- **级别递归**：中枢是级别向上构造的核心单元

### 间接影响

- **背驰判断**：A+B+C 结构中 B 段通常是中枢/盘整
- **操作决策**：中枢引力、震荡区间、支撑压力位均源于中枢

### 测试要求

- **定义检查**：`check_zhongshu_definition()` 验证三段重叠成立
- **确定性 ID**：`check_zhongshu_identity()` 保证可溯源
- **覆盖率例外**：本模块受"生成态例外"约束（见 `.claude/rules/testing-override.md`）
  - 若测试失败暴露定义冲突 → 矛盾上浮流程
  - 不可通过修改实现来让测试通过

---

## 六要素结果包

### 1. 结论

中枢（Zhongshu）是缠论体系中最基础的概念之一，定义为"某级别走势类型中，被至少三个连续次级别走势类型所重叠的部分"。当前实现 `a_zhongshu_v1.py` 采用固定区间法，由初始三段确定 [ZD, ZG]，后续段仅判延伸不改区间。

### 2. 定义依据

- **原文权威**：第17课（首次定义）、第20课（数学公式化）、第49课（三态操作）
- **知识库**：`缠论知识库.md` § 6 走势中枢
- **实体定义**：`definitions.yaml` entities[5] — 中枢
- **输入特征满足条件**：
  - 输入为 `list[Segment]`，过滤 `confirmed=True`
  - 连续三段满足 `max(lows) < min(highs)` → 三段重叠成立 → 中枢构成

### 3. 边界条件

- **翻转条件**：
  - 若 `ZG <= ZD` → 三段无公共重叠 → 不构成中枢
  - 若后续段 `dn > ZG` 或 `gn < ZD` → 延伸终止 → 中枢闭合
- **极端情况**：
  - 涨停封死 → 只能形成1分钟级别中枢延伸
  - 庄股日成交一次 → 无法形成更大级别中枢
- **下游质询点**：
  - ZG/ZD 是固定还是动态？（当前 v1 选固定）
  - 中枢扩展判定的充要性？（待验证）

### 4. 下游推论

若当前中枢定义成立，则：

1. **级别递归可行**：1分K线 → 笔 → 线段 → 走势类型 → 中枢 → 更高级别中枢
2. **走势类型唯一分类**：任何完成走势必有 ≥1 个中枢（盘整=1个，趋势≥2个）
3. **买卖点可定位**：第三类买卖点由 ZG/ZD 边界精确界定
4. **操作策略可验证**：中枢震荡、第三类买卖点均可回测验证

### 5. 谱系引用

- **已知矛盾**：无（中枢定义在原文中较为稳定，未见明显修订）
- **相关谱系**：
  - `001-degenerate-segment.md` — 退化段可能影响中枢识别准确性
  - `002-source-incompleteness.md` — 线段标准变化可能间接影响中枢组件
- **权威链依赖**：第17课（一级权威，博文原文）> 第20课（数学公式化）> 缠论知识库（三级，总结）

### 6. 影响声明

- **新增模块**：`.chanlun/definitions/zhongshu.md`（本文件）
- **已有模块**：
  - `a_zhongshu_v1.py` — 实现层（已存在，本文档化其定义依据）
  - `definitions.yaml` — entities[5] 中枢条目
  - `缠论知识库.md` — § 6 走势中枢
- **测试影响**：
  - 中枢相关测试（`test_zhongshu_*.py`）受生成态例外约束
  - 若测试失败揭示定义冲突 → 不修改实现，而是走矛盾上浮流程
- **文档新增**：本定义文件为谱系体系重要组成部分

---

**更新日志**

- 2026-02-16: v1.3 /ritual 正式结算：三问题全部结算，真实数据验证通过
- 2026-02-16: v1.2 结算问题 #2（扩展充要条件）
  - 走势类型模块(a_move_v1.py)已实现，可以评估扩展的实际处理
  - 审计结论：充要条件，原文严格推导（"等价于"+"当且仅当"+"必然要"三次确认）
  - v1 故意省略扩展逻辑（截断为不同Move），标注为 [旧缠论:选择]
  - **三个未结算问题全部结算**（#1固定区间✅ #2扩展充要✅ #3笔不裁决✅）
  - 修正谱系002引用（已结算）
- 2026-02-16: v1.1 审计+修复
  - 修复延伸判定边界条件（`>/<` → `>=/ <=`，匹配中心定理一弱不等式）
  - 修复突破方向联动（`>=/ <=` → `>/<`）
  - 结算问题 #1（固定区间正确）和 #3（笔不裁决正确）
  - 问题 #2（扩展充要条件）暂搁待走势类型模块
  - 新增 5 个边界条件测试，中枢测试 36/36 全绿
- 2026-02-15: v1.0 初始版本，基于第17课、第20课、第49课原文及当前 v1 实现整理
