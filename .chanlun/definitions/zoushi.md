# 走势类型（Zoushi / Trend Type）

**版本**: v1.1
**状态**: 生成态
**最后更新**: 2026-02-16
**原文依据**: 第17课、第18课、第20课、第21课

---

## 原文谱系

走势类型概念在缠师108课中的演化历程：

### 第17课 (2006-12-18) — 走势终完美：首次定义

> "任何级别的所有走势，都能分解成趋势与盘整两类，而趋势又分为上涨与下跌两类。"

> "缠中说禅盘整：在任何级别的任何走势中，某完成的走势类型只包含一个缠中说禅走势中枢，就称为该级别的缠中说禅盘整。"

> "缠中说禅趋势：在任何级别的任何走势中，某完成的走势类型至少包含两个以上依次同向的缠中说禅走势中枢，就称为该级别的缠中说禅趋势。该方向向上就称为上涨，向下就称为下跌。"

> "缠中说禅技术分析基本原理一：任何级别的任何走势类型终要完成。"

> "缠中说禅技术分析基本原理二：任何级别任何完成的走势类型，必然包含一个以上的缠中说禅走势中枢。"

> "缠中说禅走势分解定理一：任何级别的任何走势，都可以分解成同级别'盘整'、'下跌'与'上涨'三种走势类型的连接。"

> "缠中说禅走势分解定理二：任何级别的任何走势类型，都至少由三段以上次级别走势类型构成。"

**要点**：
- 首次给出走势类型的精确定义：趋势（≥2同向中枢）、盘整（1个中枢）
- 确立"走势终完美"原理（原理一）：任何走势类型必然完成
- 确立原理二：完成的走势类型必包含至少1个中枢
- 走势分解定理：任何走势可分解为盘整/上涨/下跌的连接
- 级别定义：最小级别从1分钟K线开始，递归向上构造

### 第18课 (2006-12-26) — 走势延伸：完美与不完美

> "三个重叠的连续次级别走势类型后，盘整就可以随时完成，也就是说，只要三个重叠的连续次级别走势类型走出来后，盘整随时结束都是完美的，但这可以不结束，可以不断延伸下去。"

> "同样，面对趋势，形成两个依次同向的缠中说禅走势中枢后，任何趋势都可以随时结束而完美，但也可以不断地延伸下去，形成更多的中枢。"

> "缠中说禅走势中枢定理一：在趋势中，连接两个同级别'缠中说禅走势中枢'的必然是次级别以下级别的走势类型。"

> "缠中说禅走势中枢定理二：在盘整中，无论是离开还是返回'缠中说禅走势中枢'的走势类型必然是次级别以下的。"

> "缠中说禅走势中枢定理三：某级别'缠中说禅走势中枢'的破坏，当且仅当一个次级别走势离开该'缠中说禅走势中枢'后，其后的次级别回抽走势不重新回到该'缠中说禅走势中枢'内。"

**要点**：
- 走势延伸：达到完成条件后可继续延续（盘整延伸、趋势延伸）
- 定理一：趋势中两中枢间连接必为次级别以下走势
- 定理二：盘整中离开和返回必为次级别以下
- 定理三：中枢破坏=次级别离开后回抽不回（第三类买卖点）

### 第20课 (2007-01-05) — 级别扩张与第三类买卖点

> "缠中说禅走势级别延续定理一：在更大级别缠中说禅走势中枢产生前，该级别走势类型将延续。"

> "缠中说禅走势级别延续定理二：更大级别缠中说禅走势中枢产生，当且仅当围绕连续两个同级别缠中说禅走势中枢产生的波动区间产生重叠。"

> "缠中说禅走势中枢中心定理一：走势中枢的延伸等价于任意区间[dn，gn]与[ZD，ZG]有重叠。换言之，若有Zn，使得dn>ZG或gn<ZD，则必然产生高级别的走势中枢或趋势及延续。"

> "缠中说禅走势中枢中心定理二：前后同级别的两个缠中说禅走势中枢，后GG<前DD，等价于下跌及其延续；后DD>前GG等价于上涨及其延续。后ZG<前ZD且后GG>=前DD，或后ZD>前ZG且后DD=<前GG，则等价于形成高级别的走势中枢。"

> "第三类买卖点定理：一个次级别走势类型向上离开缠中说禅走势中枢，然后以一个次级别走势类型回试，其低点不跌破ZG，则构成第三类买点；一个次级别走势类型向下离开缠中说禅走势中枢，然后以一个次级别走势类型回抽，其高点不升破ZD，则构成第三类卖点。"

**要点**：
- 级别延续定理：更大级别中枢产生前，当前级别走势类型将延续
- 级别扩张：两个同级别中枢波动区间重叠→形成更大级别中枢
- 中枢中心定理一：离开段[dn, gn]与中枢[ZD, ZG]不重叠→趋势延续或级别扩张
- 中枢中心定理二：用GG/DD判断趋势方向和级别扩张
- 第三类买卖点：次级别离开+回试不回中枢

### 第21课 (2007-01-09) — 买卖点完备性

> "缠中说禅买卖点的完备性定理：市场必然产生赢利的买卖点，只有第一、二、三类。"

> "缠中说禅升跌完备性定理：市场中的任何向上与下跌，都必然从三类缠中说禅买卖点中的某一类开始以及结束。换言之，市场走势完全由这样的线段构成，线段的端点是某级别三类缠中说禅买卖点中的某一类。"

> "对于盘整的情况，其中枢的扩张与新生，都不能必然保证该买点出现后能产生向上的转折，因为其扩张与新生完全可以是向下发展的，而对于中枢延续的情况，中枢形成后随时都可以打破而结束延续，也不必然有向上的转折，所以盘整的情况下，中枢下也不必然产生买点。因此，只有在下跌确立后的中枢下方才可能出现买点。这就是第一类买点。"

> "第二类买点是和第一类买点紧密相连的，因为出现第一类买点后，必然只会出现盘整与上涨的走势类型。"

**要点**：
- 买卖点完备性：只有三类买卖点，无其他类型
- 升跌完备性：所有上涨下跌都从某类买卖点开始/结束
- 第一类买点：只能出现在下跌确立后的中枢下方
- 第二类买点：第一类买点后第一个次级别回调的低点
- 第二、三类买点可能重合（第一买点后凌厉上破+回抽不回）

### 谱系小结

| 阶段 | 课号 | 核心内容 | 性质 |
|------|------|----------|------|
| 定义确立 | 第17课 | 趋势/盘整精确定义、走势终完美原理、走势分解定理 | 概念奠基 |
| 延伸理论 | 第18课 | 走势延伸、中枢定理三条、中枢破坏条件 | 动态演化 |
| 级别扩张 | 第20课 | 级别延续定理、级别扩张、第三类买卖点 | 级别跃迁 |
| 完备性 | 第21课 | 买卖点完备性定理、升跌完备性定理 | 理论封闭 |

---

## 定义

### 核心定义

**走势类型（Zoushi Type）**：任何级别的走势只有三种类型
- **盘整（Consolidation）**：某完成的走势类型只包含**1个**走势中枢
- **上涨（Uptrend）**：某完成的走势类型至少包含**2个以上**依次同向（向上）的走势中枢
- **下跌（Downtrend）**：某完成的走势类型至少包含**2个以上**依次同向（向下）的走势中枢

**趋势（Trend）**：上涨与下跌的统称

### 关键属性

1. **级别（Level）**：走势类型的级别由构成它的次级别走势类型决定
   - 本项目口径：级别=递归层级（level_id），从1分钟K线为底座递归向上
   - 禁止用"日线级别"等时间周期替代递归级别定义
2. **方向（Direction）**：
   - 趋势：中枢整体抬升=up（上涨），下移=down（下跌）
   - 盘整：取第一段次级别走势的方向
3. **完成性（Completion）**：
   - 盘整：3个连续次级别走势重叠形成中枢后即可完成
   - 趋势：2个依次同向中枢形成后即可完成
   - 但都可以继续延伸（盘整延伸、趋势延伸）
4. **构成规则**：
   - 任何走势类型至少由**3段以上**次级别走势类型构成（走势分解定理二）
   - 趋势中两中枢间的连接必为次级别以下走势（中枢定理一）

### 中枢与走势类型的关系

- **盘整延伸**：围绕同一中枢[ZD, ZG]反复震荡，不产生新中枢
- **趋势延续**：不断产生新的同向中枢（上涨：后DD > 前GG；下跌：后GG < 前DD）
- **级别扩张**：两个同级别中枢波动区间重叠→形成更大级别中枢→当前级别走势终结

---

## 当前实现

### v0 实现
- **代码位置**：`src/newchan/a_trendtype_v0.py`
- **状态**：完成（complete），保留供对比
- **中枢关系判定**（`_centers_relation`）：使用 GG/DD 判断趋势方向 ✅

### v1 实现（当前主线）
- **代码位置**：`src/newchan/a_move_v1.py`
- **状态**：完成（complete）
- **规范文件**：`docs/spec/move_rules_v1.md`

#### v1 数据结构
```python
@dataclass(frozen=True, slots=True)
class Move:
    kind: Literal["consolidation", "trend"]
    direction: Literal["up", "down"]
    seg_start: int      # identity key（第一个中枢的首段索引）
    seg_end: int
    zs_start: int       # 在 zhongshu list 中的索引
    zs_end: int
    zs_count: int       # >= 1
    settled: bool       # 最后一个 = False
    high: float         # max(center.zg)
    low: float          # min(center.zd)
    first_seg_s0: int   # 前端定位
    last_seg_s1: int    # 前端定位
```

#### v1 核心算法
1. **从中枢序列构造走势类型**（`moves_from_zhongshus`）：
   - 过滤 settled=True 的中枢
   - 贪心向右扫描，同向中枢归入同一 group
   - ≥2同向中枢 → `kind="trend"`
   - 1个中枢 → `kind="consolidation"`（方向=break_direction）
   - 最后一个 move 强制 `settled=False`

2. **趋势方向判定**（中心定理二，v1.1 修复）：
   - `_is_ascending(c1, c2)`: **c2.dd > c1.gg**（后枢波动下界 > 前枢波动上界）→ 上涨
   - `_is_descending(c1, c2)`: **c2.gg < c1.dd**（后枢波动上界 < 前枢波动下界）→ 下跌
   - ⚠️ **v1.0 曾错误使用 ZD/ZG**，v1.1 已修正为 DD/GG

3. **增量 Diff**（`diff_moves`）：
   - 身份键 = `seg_start`
   - 事件类型：MoveCandidateV1, MoveSettleV1, MoveInvalidateV1
   - 与 diff_zhongshu 同构的三段式 diff 算法

### v1.1 变更记录
- **GG/DD 修复**：趋势方向判定从 ZD/ZG 改为 DD/GG（中心定理二）
  - 原文依据：第20课 "后GG<前DD等价于下跌及其延续；后DD>前GG等价于上涨及其延续"
  - 影响：当中枢有延伸时，ZG/ZD（固定区间）和 GG/DD（波动区间）可能不同
  - v0 的 `_centers_relation` 已正确使用 GG/DD → v1.0 是回退，v1.1 修正回来

---

## 边界条件

### 正常情况
1. **最小构成**：任何走势类型至少3段次级别走势（走势分解定理二）
2. **首尾相连**：instances[i].seg1 == instances[i+1].seg0（走势分解定理一）
3. **完全覆盖**：第一个实例seg0=0，最后一个seg1=len(segments)-1

### 边界/特殊情况
1. **走势延伸**：
   - 盘整：中枢形成后可无限延伸，直到次级别离开+回抽不回
   - 趋势：2中枢形成后可无限延伸，直到出现级别扩张或反向走势
2. **级别扩张**：
   - 两个本级别中枢波动区间重叠→合并为更大级别中枢
   - 当前级别的趋势走势终结，成为更大级别中枢的一部分
3. **中枢破坏**：
   - 次级别离开中枢后，次级别回抽不回→中枢终结（第三类买卖点）
4. **走势转折**：
   - 下跌→盘整/上涨（第一类买点）
   - 上涨→盘整/下跌（第一类卖点）
5. **退化情况**：
   - 实现中需处理segment不足3段的情况（向右扩展）
6. **GG/DD 与 ZG/ZD 区分**（v1.1 新增）：
   - 无延伸中枢：GG=ZG, DD=ZD → 两种判定等价
   - 有延伸中枢：GG≥ZG, DD≤ZD → 波动区间更大
   - 必须使用 GG/DD（波动区间）判定趋势方向（中心定理二）
   - 使用 ZG/ZD（中枢区间）判定趋势方向会导致假趋势（两枢 ZD/ZG 不重叠但 GG/DD 重叠时）

### 级别递归约束
- **底座**：1分钟K线（最小不可分级别）
- **递归规则**：
  - N级走势类型由(N-1)级走势类型组合而来
  - N级中枢由3个连续(N-1)级走势类型重叠确定
  - 禁止跳级组合（如直接用笔构造高级别中枢）
- **终止条件**：当某级别不再产生足够的中枢/趋势时递归停止

---

## 未结算问题

### 1. 背驰判断
- **问题**：走势类型完成后是否必然背驰？背驰是走势完成的充分条件还是必要条件？
- **原文模糊点**：
  - 第17课说"一旦判断知道了'下跌'的结束"但未详述如何判断
  - 背驰在后续课程（动力学部分）才详细展开
- **影响**：背驰判断是实战中最关键的操作依据，需在走势类型定义中明确其地位
- **谱系引用**：待补充背驰定义文件后关联

### 2. 走势类型与买卖点的精确对应
- **问题**：
  - 第一类买点：必须在"下跌确立后"，何为"下跌确立"？（≥2中枢还是1中枢？）
  - 第二类买点：可出现在中枢上/中/下，不同位置意味着什么？
  - 第三类买点：出现后可能是趋势新生或级别扩张，如何预判？
- **原文模糊点**：第21课说"盘整的情况下，中枢下也不必然产生买点"，但未完全列举所有情况
- **影响**：买卖点的精确定位需要更严格的走势类型状态机

### 3. 多级别共振
- **问题**：当日线、30分、5分同时出现某类买卖点时如何处理？
- **原文提示**：第17课答疑"不同级别同时出现第一类买点，也就是出现不同级别的同步共振"
- **影响**：多级别共振是实战强信号，但缺乏形式化定义

### 4. 走势类型的确认时机
- **问题**：confirmed=False的最后一个实例何时转为True？
- **当前实现**：新实例产生时前一个自动confirmed=True
- **是否充分**：是否需要更严格的确认条件（如必须出现第三类买卖点）？

---

## 谱系引用

### 依赖的定义
1. **中枢（`.chanlun/definitions/zhongshu.md`）** — 核心依赖
   - 走势类型由中枢数量和关系定义
   - 中枢定理123是走势类型演化的基础
   - 需明确：中枢延伸/新生/扩张与走势类型的对应关系
2. **线段（`.chanlun/definitions/xianduan.md`）** — 次级别走势类型来源
   - 1级走势类型由线段组合而来
   - N级走势类型由(N-1)级走势类型组合而来
3. **笔（`.chanlun/definitions/bi.md`）** — 更小级别（如需）
4. **包含关系（`.chanlun/definitions/baohan.md`）** — 底层基础

### 被以下定义引用
1. **买卖点（`.chanlun/definitions/maimai.md`）v0.1 生成态** — 三类买卖点的定义完全依赖走势类型
2. **背驰（`.chanlun/definitions/beichi.md`）v0.1 生成态** — 背驰判断需要明确的趋势走势类型
3. **级别（尚未创建）** — 级别递归的形式化定义
4. **区间套（尚未创建）** — 多级别走势类型的嵌套关系

### 相关谱系记录
1. **`.chanlun/genealogy/settled/001-degenerate-segment.md`** — 退化线段问题（✅ 已结算）
   - 影响：退化线段导致走势类型判定异常
   - 结算：真实数据退化段率=0%，新笔从根源解决
2. **`.chanlun/genealogy/settled/002-source-incompleteness.md`** — 原文不完整性（已结算）
   - 影响：编纂版缺失第67、71、77、78课，已补录原始博文
3. **`.chanlun/genealogy/pending/004-provenance-framework.md`** — 概念溯源框架
   - 影响：走势类型中的趋势定义使用 GG/DD → 溯源标签 `[旧缠论]`（原文第20课明确）
4. **`.chanlun/genealogy/pending/005-object-negation-principle.md`** — 对象否定对象原则 `[新缠论]`
   - 影响：走势完成必须由同级别内部机制否定，不允许超时/阈值等外部否定

---

## 影响声明

### 影响的模块
1. **`src/newchan/a_move_v1.py`** — 走势类型实例构造 v1（当前主线，v1.1 GG/DD 修复）
2. **`src/newchan/a_trendtype_v0.py`** — 走势类型实例构造 v0（保留供对比）
3. **`src/newchan/a_level_fsm_newchan.py`** — 级别递归引擎（部分实现）
4. **`src/newchan/a_divergence.py`** — 背驰判断（已实现，但可能需要调整）
5. **`src/newchan/core/recursion/move_engine.py`** — 走势类型增量引擎
6. **`src/newchan/core/recursion/move_state.py`** — 走势类型 diff 状态机
7. **买卖点模块（尚未实现）** — 三类买卖点识别
8. **区间套模块（尚未实现）** — 多级别嵌套分析

### 影响的定义
1. **中枢定义** — 走势类型与中枢互为定义（中枢由次级别走势类型重叠定义）
2. **级别定义** — 级别递归的核心就是走势类型的递归构造
3. **背驰定义** — 背驰必须在"趋势"中判断（盘整中只有盘整背驰）

### 下游推论
1. **操作策略**：
   - 盘整中：等待第三类买卖点（中枢破坏）
   - 趋势中：持有到同级别或次级别第一类买卖点
   - 级别扩张：降低操作频率，等待更大级别买卖点
2. **风险管理**：
   - 盘整可能无限延伸→需设置时间止损
   - 趋势可能无限延续→不要主观预测顶底
   - 级别扩张需及时识别→避免在错误级别操作
3. **理论完备性**：
   - 买卖点完备性定理→所有操作都基于三类买卖点
   - 升跌完备性定理→市场走势完全被三类买卖点分割
   - 理论的封闭性→无需引入其他买卖依据

---

## 结论

走势类型定义是缠论操作系统的最高层抽象，**所有买卖操作的合法性都由走势类型和买卖点定理保证**。

**当前状态**：
- 核心定义清晰（趋势/盘整的中枢数量判定）
- v0 和 v1 双实现已运行
- v1.1 已修复趋势方向判定（GG/DD 中心定理二）
- 但仍处于**生成态**，原因：
  1. 背驰判断与走势完成的关系需要明确（依赖背驰定义文件）
  2. 买卖点与走势类型的精确对应需要形式化（依赖买卖点定义文件）
  3. 多级别共振和级别递归的完整规则需要补充（依赖级别定义文件）
  4. 确认时机的严格条件需要形式化

**下一步**：
1. 创建买卖点定义文件（三类买卖点的完整定义）
2. 创建背驰定义文件（背驰与走势完成的关系）
3. 创建级别定义文件（递归级别的形式化）
4. 完成上述后，本定义可从生成态转为结算态

**变更历史**：
- v1.0 (2026-02-15)：初始定义，原文谱系梳理，4个未结算问题
- v1.1 (2026-02-16)：GG/DD 修复（中心定理二），v1 实现信息更新，谱系 004/005 关联
