# 矛盾记录 001：退化段——古怪线段与笔定义的关系

**状态**: 生成态
**创建时间**: 2026-02-15
**更新时间**: 2026-02-15（第三次修订：补入第78课+新笔定义原文）
**域**: 线段 (Segment) ← 笔 (Stroke)
**来源**: 蜂群创世仪式 D线段修复工位 → 编排者指示回溯原文 → 补入第78课

---

## 矛盾描述

线段 v1 特征序列法产出了 `direction=up` 但 `ep1_price < ep0_price` 的退化段。

## 原文回溯（完整链条）

### 1. 硬约束（第67课+第78课）

> "一个线段，两端的一顶一底，**顶肯定要高于底**"
> — 第78课：继续说线段的划分

这是硬约束，不是推论。违反此条件的线段划分是错误的。

### 2. 古怪线段的成因（第78课）

> "所有古怪的线段，都是因为线段出现**第一种情况的笔破坏后最终没有在该方向由该笔发展形成线段破坏**所造成的"

机制：
- 特征序列出现第一种分型（无缺口）→ 触发笔破坏
- 但该笔破坏之后，**没有在该方向形成新线段**
- 结果：原线段在特征序列法视角下被"破坏"了，但实际上新线段未形成
- 这种情况下线段不应终结，应继续延伸

### 3. 缠师的解法——新笔定义（《忽闻台风可休市》2007-09-18）

缠师认为古怪线段的根因在**笔的定义过严**，因此修改笔的成立条件：

**旧笔**：顶底分型间必须有独立K线（不属于任一分型）
**新笔**：顶分型最高K线与底分型最低K线之间（不含这两K线），至少3根K线

放松后的效果：原来被强制成笔的某些短促波动不再成笔 → 不再产生导致古怪线段的分型组合。

### 4. 知识链条（第67→71→77→78课）

- **第67课**：线段划分标准（特征序列法的完整定义）
- **第71课**：线段划分标准的再分辨（特征序列包含关系的严格性）
- **第77课**：一些概念的再分辨
- **第78课**：继续说线段的划分（古怪线段+硬约束）
- **忽闻台风可休市**：新笔定义（从笔层面根治古怪线段）

## 矛盾重新定位

**退化段不是"原文断言 vs 原文算法"的矛盾。**

退化段的产生原因是：
1. 我们的笔定义可能使用的是旧笔（或未完全对齐新笔）
2. 旧笔定义下会产生不合理的分型组合
3. 这些分型组合在特征序列法中触发了"第一种笔破坏"
4. 但笔破坏没有发展成线段破坏
5. 产出了违反"顶高于底"硬约束的退化段

## 待验证

- [ ] 当前 `a_stroke.py` 使用的是旧笔还是新笔定义？
- [ ] 如果是旧笔：切换到新笔后退化段是否消失？
- [ ] 如果已经是新笔：退化段是否由其他原因引起（v1 实现 bug）？
- [ ] 是否需要在线段层面增加 `gi > d1` 作为后置过滤？
- [ ] 新笔条件2的"考虑包含关系"vs"不考虑包含关系"之争，我们取哪种口径？

## 知识库缺口

以下内容不在仓库中，需要补录：
- 第67课：线段划分标准
- 第71课：线段划分标准的再分辨
- 第77课：一些概念的再分辨
- 第78课：继续说线段的划分（古怪线段）
- 《忽闻台风可休市》：新笔定义

推荐来源：https://www.fengmr.com/chanlun.html （枫之羁绊，原文+配图+答疑）

## 影响范围

- `a_stroke.py`：笔定义是否对齐新笔？
- `a_segment_v1.py`：是否需要增加 gi > d1 后置过滤？
- `definitions.yaml` 笔实体：boundary_conditions 需补充新笔定义
- `缠论知识库.md`：需补充古怪线段和新笔定义的内容

## 谱系链接

- 前置：无（首条记录）
- 后续：待笔定义验证后决定走向
