# 矛盾记录 001：退化段——古怪线段与笔定义的关系

**状态**: 生成态 → 待结算（假说已验证，待真实数据确认）
**创建时间**: 2026-02-15
**更新时间**: 2026-02-15（第四次修订：假说验证完成，mode="new"已实现）
**域**: 线段 (Segment) ← 笔 (Stroke)
**来源**: 蜂群创世仪式 D线段修复工位 → 编排者指示回溯原文 → 补入第78课

---

## 矛盾描述

线段 v1 特征序列法产出了 `direction=up` 但 `ep1_price < ep0_price` 的退化段。

## 原文回溯（完整链条）

### 1. 硬约束（第67课+第78课）

> "一个线段，两端的一顶一底，**顶肯定要高于底**"
> — 第78课：继续说线段的划分

这是硬约束，不是推论。违反此条件的线段划分是错误的。

### 2. 古怪线段的成因（第78课）

> "所有古怪的线段，都是因为线段出现**第一种情况的笔破坏后最终没有在该方向由该笔发展形成线段破坏**所造成的"

机制：
- 特征序列出现第一种分型（无缺口）→ 触发笔破坏
- 但该笔破坏之后，**没有在该方向形成新线段**
- 结果：原线段在特征序列法视角下被"破坏"了，但实际上新线段未形成
- 这种情况下线段不应终结，应继续延伸

### 3. 缠师的解法——新笔定义（《忽闻台风可休市》2007-09-18）

缠师认为古怪线段的根因在**笔的定义过严**，因此修改笔的成立条件：

**旧笔**：顶底分型间必须有独立K线（不属于任一分型）
**新笔**：顶分型最高K线与底分型最低K线之间（不含这两K线），至少3根K线

放松后的效果：原来被强制成笔的某些短促波动不再成笔 → 不再产生导致古怪线段的分型组合。

### 4. 知识链条（第67→71→77→78课）

- **第67课**：线段划分标准（特征序列法的完整定义）
- **第71课**：线段划分标准的再分辨（特征序列包含关系的严格性）
- **第77课**：一些概念的再分辨
- **第78课**：继续说线段的划分（古怪线段+硬约束）
- **忽闻台风可休市**：新笔定义（从笔层面根治古怪线段）

## 矛盾重新定位

**退化段不是"原文断言 vs 原文算法"的矛盾。**

退化段的产生原因是：
1. 我们的笔定义可能使用的是旧笔（或未完全对齐新笔）
2. 旧笔定义下会产生不合理的分型组合
3. 这些分型组合在特征序列法中触发了"第一种笔破坏"
4. 但笔破坏没有发展成线段破坏
5. 产出了违反"顶高于底"硬约束的退化段

## 验证结果（2026-02-15）

- [x] 当前 `a_stroke.py` 使用的是旧笔（wide模式，merged gap>=4）。
- [x] 旧笔产出退化段：7笔序列（含回头波动）→ v1 产出 `direction=up, ep1=99 < ep0=100`。
- [x] 精简笔序列（模拟新笔过滤掉短促波动）→ v1 产出正常段 `ep1=115 > ep0=100`。
- [x] 新笔条件2："不考虑包含关系" = 在原始K线上计数。原文（L110）明确。
- [x] `mode="new"` 已实现并通过测试（28/28 + 2/2）。
- [ ] 在真实市场数据上端到端验证新笔效果。
- [ ] 确认是否需要在线段层面增加后置过滤（可能不需要——新笔从根源解决）。

**结论**：退化段根因是旧笔拒绝了应成笔的短促波动，导致笔序列中出现"回头波动"，使线段在错误位置终结。新笔消除退化段的假说**成立**。

## 知识库缺口（已全部补录 ✓）

- ✅ 第67课：线段划分标准 → `blog/067-第67课.md`
- ✅ 第71课：线段划分标准的再分辨 → `blog/071-第71课.md`
- ✅ 第77课：一些概念的再分辨 → `blog/077-第77课.md`
- ✅ 第78课：继续说线段的划分（古怪线段）→ `blog/078-第78课.md`
- ✅ 《忽闻台风可休市》：新笔定义 → `blog/081-第81课.md` L108-114

## 影响范围

- `a_stroke.py`：已实现 `mode="new"` + `merged_to_raw` 参数 ✅
- `a_segment_v1.py`：暂不改（新笔从根源解决，可能不需要后置过滤）
- `.chanlun/definitions/bi.md`：已更新至 v1.2 ✅
- `缠论知识库.md`：已补充新笔定义（§4.3）和古怪线段（§5.6）✅

## 结算条件

本记录可以从 `pending/` 移至 `settled/`，当：
1. ~~假说验证~~ ✅ 已完成
2. [ ] 在真实市场数据上确认新笔不引入新问题
3. [ ] `mode="new"` 设为默认值（或明确决定保留 mode 选择）

## 谱系链接

- 前置：无（首条记录）
- 后续：002-source-incompleteness（知识库缺口已补录）、003-segment-concept-separation（两口径差异可能在新笔下收敛）
