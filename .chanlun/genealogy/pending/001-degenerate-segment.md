# 矛盾记录 001：退化段——方向与价格走向的概念分离

**状态**: 生成态
**创建时间**: 2026-02-15
**域**: 线段 (Segment)
**来源**: 蜂群创世仪式，D线段修复工位概念确认

---

## 矛盾描述

线段 v1 特征序列法会产出"退化段"：`direction=up` 但 `ep1_price < ep0_price`。
即结构方向为"向上"，但终点价格反而低于起点价格。

## 矛盾本质

**"方向"一词同时承载了两个不同概念**，在常规情况下它们一致，在边界情况下分裂：

1. **结构方向 (structural_direction)**：由特征序列法的起始笔方向决定，是拓扑性质
2. **价格走向 (price_direction)**：由端点价格高低决定，是度量性质

## 涉及的定义

- 缠论原文 §5.1："线段方向与起始笔一致"
- 缠论原文 §5.5："线段终结的充要条件就是另一个线段生成"
- `definitions.yaml` 线段实体 L160-161："向上线段从向上笔开始"
- `docs/spec/segment_rules_v1.md`：两阶段结算流程，段终点由分型中心 b 决定

## 概念分离方案

### 分离后的两个概念

| 概念 | 含义 | 决定因素 | 取值 |
|------|------|---------|------|
| `direction` | 结构方向 | 起始笔方向（特征序列法） | up / down |
| `is_degenerate` | 是否退化 | `direction=up 且 ep1_price < ep0_price`，或反之 | bool |

### 工程约定

- `direction` 字段保持原义（结构方向），**不做修改**
- 新增 `is_degenerate` 标记，用于上层（中枢构造/走势类型）识别边界情况
- 退化段是合法的线段（特征序列法的必然结果），**不是 bug**
- 上层模块遇到退化段时，必须显式处理，不得静默忽略

## 双方论证存档

**立场 A（保持原文，接受退化）**：
- 优势：忠于原文，特征序列法的拓扑性质自洽
- 代价：上层必须处理退化段的度量异常

**立场 B（回退全局极值）**：
- 优势：消除退化段，价格走向与方向一致
- 代价：破坏"分型中心 b 决定终点"的简洁性，端点可能跳跃

**编排者决断**：概念分离。不选 A 也不选 B，而是承认两者是不同概念，用 `is_degenerate` 标记分裂点。

## 影响范围

- `Segment` 数据结构：新增 `is_degenerate: bool` 字段
- `a_segment_v1.py`：结算时计算并填充该字段
- `a_center_v0.py`：构造中枢时需检查输入段是否退化
- `a_trendtype_v0.py`：走势类型判定需考虑退化段
- `assert_segment_theorem_v1`：退化段断言从"失败"改为"标记"

## 待实践验证

- [ ] 退化段在真实数据中出现的频率
- [ ] 上层模块对退化段的容错策略是否充分
- [ ] 是否存在连续退化段导致中枢判定异常的情况

## 谱系链接

- 前置：无（首条记录）
- 后续：待实践后结算
