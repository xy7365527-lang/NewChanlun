# 概念分离 003：线段的两个口径

**状态**: 生成态
**创建时间**: 2026-02-15
**类型**: 概念分离（自治行为）
**域**: 线段（Segment）
**来源**: 编排者指出"分离首先在线段两个口径上"，且"概念分离也需要被谱系化"

---

## 分离描述

"线段"在本仓库中存在两个独立口径，已实现为两个并行模块。本记录将其正式分离为两个命名概念。

## 分离前

"线段"作为单一概念，但有两种实现：
- `a_segment_v0.py` — 称为"v0"
- `a_segment_v1.py` — 称为"v1"

两者共用同一个 `Segment` 数据类（定义在 `a_segment_v0.py`），没有形式化的概念区分。

## 分离后的两个概念

### 概念 A：三笔重叠线段（v0）

- **文件**: `a_segment_v0.py :: segments_from_strokes_v0`
- **定义**: 连续三笔 price range 有交集（`overlap_low < overlap_high`）即成段
- **算法**: 贪心窗口扫描，成段后跳两笔
- **方向**: 第一笔方向
- **原文对应**: 对"至少三笔"规则的简化理解
- **特征**: 无特征序列分析，无分型验证，无结算锚

### 概念 B：特征序列线段（v1）

- **文件**: `a_segment_v1.py :: segments_from_strokes_v1`
- **定义**: 反向笔组成特征序列，特征序列出现分型则旧段终结、新段生成
- **算法**: 增量特征序列扫描 + 分型触发 + 结算锚验证（新段前三笔必须重叠）
- **方向**: 第一笔方向
- **原文对应**: §67课特征序列法
- **特征**: 有 `_FeatureSeqState` 状态机，有 `BreakEvidence` 断段证据

## 共享结构

两个口径共用 `Segment` 数据类，其中：
- `kind` 字段：`"settled"` / `"candidate"` — v1 使用，v0 默认 `"settled"`
- `break_evidence` 字段：v1 写入，v0 为 `None`
- `ep0_*` / `ep1_*` 端点字段：两者都写入，但计算方式不同

## 待验证

- [ ] v0 是否产生退化段（direction=up 但 ep1_price < ep0_price）？→ 对接谱系 001
- [ ] v1 是否产生退化段？
- [ ] 两个口径在相同输入上的输出差异有多大？
- [ ] 退化段是口径差异导致还是笔定义导致？

## 谱系链接

- 前置：001-degenerate-segment.md（退化段问题触发了对线段口径的审视）
- 前置：002-source-incompleteness.md（§67课原文已补录，可作为验证依据）
- 后续：待实证对比后，可能结算 001
