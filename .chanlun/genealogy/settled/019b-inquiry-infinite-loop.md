# 019b — 质询退回-修正无限循环

**状态**: 已结算
**结算日期**: 2026-02-18
**结算方式**: 020号谱系子发现结算（G3子发现，阈值→结构完成检测）
**类型**: meta-rule
**日期**: 2026-02-18
**溯源**: [新缠论]
**域**: 元编排方法论（质询架构）

---

## 矛盾描述

质询序列（/inquire）的"退回→修正→重新质询"子循环没有终止条件，没有迭代计数，没有差异追踪。上游被退回后修正并重新提交，如果始终通不过质询，系统无退出机制。

/inquire 定义了四种结果，但只规定了**单次质询**的判定逻辑，没有规定**多次质询之间**的状态转移规则。质询被定义为无状态的单次操作，不是有状态的迭代过程。

## 发现过程

### 故障场景

线段特征序列包含关系的边界判定：

- T2：反例构造失败 → 退回（"第三笔完全包含情况未处理"）
- T4：定义回溯失败 → 退回（"应同时引用第78课"）
- T6：推论不一致 → 退回或上浮？不确定

三轮退回中，原因从"实现不完整"滑移到"定义之间的张力"（71课 vs 78课），但系统没有信号标记这次滑移。

### 关键发现

1. **退回/上浮的判断标准已存在但未统一应用**：testing-override.md 写了"修复需要改定义=定义冲突"，但这只在测试场景中定义，没有移植到 /inquire 的退回判断中。这是一个**语法记录候选**。
2. **退回循环会造成死锁**：谱系工位在循环解决前无法介入，但循环可能需要谱系工位的同构性检测才能终止。
3. **上下文消耗严重**：每轮退回-修正约 7000-13000 tokens，3轮可达 40000 tokens——超过 ceremony 冷启动的 2-4 倍。

## 修复方向

### 三层防线

| 层 | 机制 | 触发 |
|----|------|------|
| 1 | 退回计数器 + 差异追踪 | 每次退回附带结构化历史（轮次号、上次退回原因、涉及定义集合、是否重叠） |
| 2 | 自动升级阈值 | ≥3次退回 → 强制 /escalate；≥2次且定义重叠 → 显式选择退回或上浮 |
| 3 | 谱系工位主动介入 | 退回轮次=2 时触发张力检查，搜索已有谱系中的同构矛盾 |

### 阈值为3的依据

- 第1次：质量校正（正常）
- 第2次：预警+谱系预检（边缘态）
- 第3次：强制显式化——"实现复杂度还是定义张力？"（决策点）
- 3 是最小的可判断趋势的样本量

### 与016的关系

退回计数器如果只写入 /inquire 文档，按016就不会被执行。需要：
- quality-guard 检查清单增加"退回产出必须包含 inquiry_round"
- /inquire 命令 ≥3 轮时输出模板自动切换为 /escalate 格式
- genealogist 响应中断表增加"退回循环达到2轮"

## 推导链

1. /inquire 定义了四种单次结果（事实）
2. 结果2（退回修正）可无限循环（事实）
3. testing-override.md 已有"改定义=定义冲突"的判据（已结算）
4. 但此判据未移植到 /inquire（遗漏）
5. 016 证明概念层规则需要 runtime 强制（已结算）
6. ∴ 退回循环的终止机制需要从概念层规则 + runtime 强制两个层面同时实现

## 谱系链接

- **父**: 019-loop-breakpoint-coverage（本条是 019 的子发现 G3）
- **前置**: 016-runtime-enforcement-layer（规则需要 runtime 强制）
- **前置**: 018-four-way-classification（退回计数器=行动，阈值=选择，判据统一=语法记录）
- **关联**: 013-swarm-structural-stations（谱系工位在退回循环中的主动介入）

## 影响

- `.claude/commands/inquire.md`：增加退回计数器、差异追踪、自动升级阈值
- `SKILL.md` 质询章节：增加退回次数判定分支
- `.claude/agents/quality-guard.md`：检查清单增加 inquiry_round
- `.claude/agents/genealogist.md`：响应中断增加退回循环触发
- `.claude/agents/meta-lead.md`：路由规则增加退回计数判定

## 实施记录

- **日期**: 2026-02-18
- **文件**: `.claude/commands/inquire.md`（退回循环管理章节）、`.claude/agents/quality-guard.md`（退回检查）
- **第一轮实施**: 三层防线（阈值=3）
- **第二轮重构（020号存在论位移）**: 从固定阈值改为**结构完成检测**——质询K线（每轮退回=一根K线，High/Low/实体映射），背驰（净新区分递减）+ 分型（范围先扩后缩）= 循环结构完成。3的身份从"阈值"变为"分型最小数据量"（结构必然性）。
- **保留**: 锚定条件要求——无锚定退回=语法不合法（005a同构）
- **保留**: 谱系预检（轮次≥2 触发 genealogist 搜索同构矛盾）

## 来源

- [新缠论] — 系统性审计中的循环控制分析
