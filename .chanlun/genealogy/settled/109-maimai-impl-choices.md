---
id: "109"
title: "买卖点定义到实现的选择谱系"
status: "已结算"
type: "语法记录"
date: "2026-02-22"
depends_on: []
related: ["007", "009"]
negated_by: []
negates: []
provenance: "[旧缠论:选择]"
---

# 109 — 买卖点定义到实现的选择谱系

**类型**: 语法记录
**状态**: 已结算
**日期**: 2026-02-22
**域**: 买卖点（MaiMai / BuySellPoint）
**溯源**: [旧缠论:选择]

---

## 目的

记录买卖点概念从缠论原文定义到 `a_buysellpoint_v1.py` 实现过程中做出的选择。这些选择已在代码和 `maimai.md` 中运作，但缺乏独立的谱系追踪。

---

## 选择清单

### C1: 第一类买卖点——趋势背驰驱动

**原文**：
- "第一类买点：某级别下跌趋势中，一个次级别走势类型向下跌破最后一个走势中枢后形成的背驰点"（第17课）

**选择**：Type 1 BSP = `Move(kind="trend")` + 最后中枢后存在 `Divergence(kind="trend")`。

**依据**：
- 原文明确：第一类买卖点 = 趋势背驰点
- 代码中 `_detect_type1_buy()` / `_detect_type1_sell()` 检查 Move.kind=="trend" + Divergence 存在性

**替代方案被否定**：
- 盘整背驰产生第一类买卖点 → 违反原文"没有趋势就没有背驰"
- maimai.md #4 已结算：盘整背驰不产生三类买卖点中的任何一类

### C2: 下跌确立——严格口径 ≥2 中枢

**原文**：
- "只有在下跌确立后的中枢下方才可能出现买点"（第21课）

**选择**：下跌确立 = `Move(kind="trend", direction="down")`，即 ≥2 个同向下跌中枢。

**依据**：
- maimai.md #1 已结算：严格口径 ≥2 中枢 [旧缠论]
- 宽松口径（1个中枢即可）被否定——1个中枢只构成盘整，非趋势

**谱系引用**：maimai.md #1 已结算

### C3: 第二类买卖点——次级别走势结构定义

**原文**：
- "第二类买点 = 第一类买点的次级别回抽结束后再次探底的那个次级别走势的结束点"（第101课L22）

**选择**：Type 2 BSP 的定义核心是**次级别走势结构**，而非中枢位置关系。代码实现中通过 Move.settled 追踪走势完成，BSP.confirmed 对齐到 Move.settled。

**依据**：
- zoushi.md #2 已结算（编排者决断）：第二类买卖点的位置与中枢的关系是事后概率观察，非定义要素
- 第25课L45："第二类买点，不必然出现在走势中枢的上或下，可以在任何位置出现"

**谱系引用**：zoushi.md #2 已结算

### C4: 第三类买卖点——ZG/ZD 边界判定

**原文**：
- "次级别向上离开中枢，然后次级别回试其低点不跌破ZG → 第三类买点"（第20课）

**选择**：Type 3 BSP = 次级别离开 + 次级别回试 + 回试低点 vs ZG（买点）或回试高点 vs ZD（卖点）。

**依据**：
- 原文给出精确的数学判定条件
- ZG/ZD 使用固定区间（与 107号 C2 选择一致）

### C5: confirmed 语义对齐——Move.settled

**选择**：BSP.confirmed 不来自 Segment.confirmed，而来自 Move.settled。

**依据**：
- maimai.md #2 已结算：买卖点的确认应与所属走势类型的完成状态一致
- Segment.confirmed 只表示线段本身确认，不表示走势类型完成
- Move.settled 表示走势类型已被后续走势否定（完成）

**谱系引用**：maimai.md #2 已结算

### C6: 身份键——(seg_idx, kind, side, level_id)

**选择**：BuySellPoint 的身份由四元组唯一确定。

**依据**：
- seg_idx 定位到具体线段
- kind 区分三类
- side 区分买/卖
- level_id 区分级别
- 四元组保证同一买卖点在增量 diff 中可稳定追踪

### C7: 2B+3B 重合标记

**原文**：
- "第二、三类买点可能重合（第一买点后凌厉上破+回抽不回）"（第21课）

**选择**：`BuySellPoint.overlaps_with` 可选字段标记重合情况。

**依据**：
- 原文承认此现象存在
- 代码不合并重合的买卖点，而是分别产出并标记关联

---

## 六要素

### 1. 结论
买卖点实现做了七项选择（C1-C7），核心选择是趋势背驰驱动Type 1 + 严格下跌确立口径 + 次级别走势结构定义Type 2 + ZG/ZD边界判定Type 3。

### 2. 定义依据
第17课（第一/二类首次定义）、第20课（第三类定义）、第21课（完备性定理）、第101课（第二类精确定义）。maimai.md v1.0（已结算）。

### 3. 边界条件
- C2（严格口径）如果发现原文支持宽松口径的新证据则需重审（当前无此证据）
- C5（Move.settled 对齐）如果走势类型的完成机制改变（如引入超时），则 BSP.confirmed 语义随之改变
- C4（ZG/ZD 固定区间）与 107号 C2 绑定——如果中枢区间法改为动态，第三类判定条件随之改变

### 4. 下游推论
- 区间套搜索在多级别上递归产出买卖点——C1-C4 的选择在每个级别一致适用
- 操作策略层直接消费 BuySellPoint——C6 身份键的稳定性影响策略层的追踪能力
- 回测系统依赖买卖点的产出——选择变更需要回测验证

### 5. 谱系引用
- maimai.md v1.0（5/5 问题已结算）
- zoushi.md v1.6（#2 买卖点精确对应已结算）
- 007号（趋势独立实体——Type 1 依赖趋势概念）
- 009号（盘整独立实体——盘整背驰不产生买卖点）

### 6. 影响声明
- 新增 `.chanlun/genealogy/settled/109-maimai-impl-choices.md`（本文件）
- 不改动任何代码或定义文件——本条目纯粹是已运作选择的显式记录
