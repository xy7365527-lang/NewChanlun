---
id: "112"
title: "热启动机制的生成史——从 session 膨胀到三级恢复保障"
status: "已结算"
type: "语法记录"
date: "2026-02-22"
depends_on: ["017", "057", "058"]
related: ["019", "081", "044"]
negated_by: []
negates: []
provenance: "[新缠论]"
---

# 112 — 热启动机制的生成史

**类型**: 语法记录（从概念需求到运行机制的演化记录）
**状态**: 已结算
**日期**: 2026-02-22
**域**: 元编排方法论（状态持久化与恢复）
**溯源**: [新缠论]

---

## 机制内容

CLAUDE.md 原则9："热启动保障蜂群持续自动化。当上下文压缩（compact）发生时，通过 session 记录和 ceremony 恢复蜂群状态。" 三级恢复保障（L0 正常 / L1 compact / L2 新对话）确保蜂群"永远在线"。

## 生成史追踪

### 概念需求的产生

热启动机制的需求源于蜂群运行的根本矛盾：**LLM 上下文有限** vs **蜂群需要持续运行**。这个矛盾在以下谱系节点逐步显现：

1. **017号（Session 是指针，不是叙事）**（2026-02-17）：发现 session 文件在重演 SKILL.md 的膨胀模式（1035行全量叙事）。解决方案：session 从全量内容变为 ~50 行指针格式。这是热启动的**数据格式基础**——没有精简的 session 格式，热启动加载时间会过长。
   - git：`538344a` "refactor: session从全量叙事变为指针格式（谱系017）"

2. **019号（循环结构缺少断点覆盖）**（2026-02-18）：发现元编排的 7 个循环结构中，只有热启动恢复循环（C6）的断点覆盖基本完整。这反向证明热启动在 019号之前已经被设计（C6 已在运作），但其他循环断点缺失暴露了整体设计的不完整性。

3. **057号（LLM 不是状态机）**（2026-02-20）：ceremony 热启动中暴露两个独立故障——信任倒置（agent 管理 flag）和数据腐化（definitions.yaml 缓存过时）。Gemini 诊断共同根因为"对 LLM 行为确定性的错误假设"。这促使热启动机制从"LLM 负责状态管理"转变为"框架层负责状态管理，LLM 只触发信号"。
   - git：`576f6e9` "feat: 057+058号谱系——LLM非状态机 + Ceremony是Swarm₀"

4. **058号（Ceremony 是 Swarm₀）**（2026-02-20）：确立 ceremony 不是蜂群的前置阶段，而是 Swarm₀（第0层递归）。热启动因此不是"在蜂群外恢复状态再进入蜂群"，而是"Swarm₀ 直接从 session 快照恢复并递归进入下一层"。

### 从概念到机制的转变

热启动从概念变为可运行机制的关键节点：

| 时间 | 事件 | 机制变更 |
|------|------|----------|
| 2026-02-15 | `.claude/rules/` 入仓 | CLAUDE.md 首次包含热启动概念描述 |
| 2026-02-17 | 017号结算 | session 格式精简为指针（~50行） |
| 2026-02-17 | `538344a` | `precompact-save.sh` 首次实现——PreCompact hook 自动保存 session |
| 2026-02-18 | 019号结算 | 7 个循环的断点覆盖审计，C6（热启动循环）被确认为最完整的循环 |
| 2026-02-20 | 057号结算 | ceremony 守卫从 LLM 管理改为框架层管理（信任倒置修复） |
| 2026-02-20 | 058号结算 | ceremony = Swarm₀，热启动 = Swarm₀ 的恢复模式 |
| 2026-02-21 | v18/v19/v20-swarm | ceremony warm_start 在实际 compact 中反复执行（git 日志显示 6+ 次 warm_start session） |
| 2026-02-21 | 081号结算 | ceremony_scan.py 的假阴性"干净终止"被发现，终止逻辑修正 |
| 2026-02-21 | 084号审计 | precompact-save.sh 被确认为正常运转的 hook |

### 三级恢复的结晶

三级恢复保障（L0/L1/L2）的最终形式是多个谱系节点的综合结晶：

- **L0 正常**：上下文充足时蜂群持续运行（无需恢复）
- **L1 compact**：PreCompact hook（`precompact-save.sh`）自动写入 session，compact 后加载最近 session 续接（017号格式 + 057号框架层管理）
- **L2 新对话**：新对话执行 `/ceremony`，ceremony 检测 session 记录切换为热启动模式（058号 Swarm₀ + 版本对比机制）

git 日志中 `warm_start` 关键词出现在 10+ 个 commit 中（从 `56c7a6b` 到 `be87863`），表明 L1/L2 恢复在 v18-v31 swarm 期间被反复实际使用。

---

## 六要素

### 1. 结论
热启动机制从概念需求（LLM 上下文有限 vs 蜂群持续运行）经 017/019/057/058 四个谱系节点逐步演化为三级恢复保障。关键转变是 057号确立"LLM 不是状态机"后，状态管理权从 LLM 移到框架层（hook/脚本），使热启动从依赖 LLM 自律变为结构性保障。

### 2. 定义依据
- 017号："任何容器膨胀的成本从 O(n) 变 O(1)，方法是按需索引" → session 精简为热启动的数据格式基础
- 057号："LLM 是推理引擎，不是状态机" → 状态管理权外移为热启动的架构基础
- 058号："Ceremony 是 Swarm₀" → 热启动 = Swarm₀ 的恢复模式

### 3. 边界条件
- 如果 Claude Code 平台支持持久化上下文（无 compact），L1 级恢复变得不必要（但 L2 仍需要，因为会话超时/关闭不可避免）
- 如果 session 格式从 ~50 行膨胀回全量叙事，热启动加载时间增加，可能导致 ceremony 超出单 turn 限制
- precompact-save.sh 依赖 PreCompact hook 事件——如果该事件被平台移除，L1 级恢复失效

### 4. 下游推论
- 热启动是蜂群"永远在线"的物质基础——如果热启动失效，蜂群退化为单次对话工具
- session 文件是跨对话的唯一状态载体——session 格式的任何变更直接影响热启动能力
- L2 级恢复依赖 ceremony——ceremony 的任何变更需要同步评估热启动影响

### 5. 谱系引用
- 017号（Session 是指针）—— session 精简为热启动数据格式基础
- 019号（循环结构断点）—— 热启动循环（C6）被确认为最完整的断点覆盖
- 057号（LLM 不是状态机）—— 状态管理权外移的转折点
- 058号（Ceremony 是 Swarm₀）—— 热启动 = Swarm₀ 恢复模式
- 081号（持续自动化断裂）—— ceremony_scan.py 假阴性暴露终止逻辑缺口

### 6. 影响声明
- 新增 `.chanlun/genealogy/settled/112-warm-start-genesis.md`（本文件）
- 不改动任何代码或定义文件——本条目纯粹是热启动机制从概念到实现的演化记录
- 更新 `dag.yaml`：新增节点 112 及其边
