---
id: "113"
title: "包含处理工程选择谱系"
status: "已结算"
type: "语法记录"
date: "2026-02-22"
depends_on: []
related: ["001", "002"]
negated_by: []
negates: []
provenance: "[旧缠论:选择]"
---

# 113 -- 包含处理工程选择谱系

**类型**: 语法记录
**状态**: 已结算
**日期**: 2026-02-22
**域**: 包含处理（Baohan / Inclusion Merge）
**溯源**: [旧缠论:选择]

---

## 目的

记录包含处理概念从缠论原文定义到 `a_inclusion.py :: merge_inclusion` 实现过程中做出的工程选择。这些选择已在代码和 `baohan.md` 定义文件中运作，但缺乏独立的谱系追踪。包含处理是管线第一步，所有后续概念建立于此。

---

## 选择清单

### C1: 方向判定——双条件 vs 单条件

**原文**（第65课 L24）：单条件
- `gn >= gn-1` -> 向上
- `dn <= dn-1` -> 向下

**代码实现**：双条件
- `high_i > high_{i-1} AND low_i > low_{i-1}` -> dir = UP
- `high_i < high_{i-1} AND low_i < low_{i-1}` -> dir = DOWN
- 否则 dir 保持不变

**概念路径差异**：
- 原文从包含关系定义出发推论："如果 gn<gn-1 且 dn>dn-1，那就是包含关系，违反了非包含前提"（第65课 L26）。因此在非包含前提下，单条件逻辑完备。
- 代码直接检查双条件，是防御性实现——不依赖"已排除包含"的前提隐式保障。

**数学等价性**：在非包含前提下，单条件与双条件的数学结果相同（baohan.md v1.3 结算）。差异仅在概念路径：原文是"从定义推论"，代码是"直接防御"。

**选择时间**：初始实现时选定，baohan.md v1.3 结算确认数学等价。

**谱系引用**：baohan.md 差异记录、v1.2 生成态回退与 v1.3 结算过程。

### C2: 等号问题——严格不等式 vs 非严格不等式

**原文**（第65课 L24）：使用 `>=` 和 `<=`（非严格不等式）。
有编者注"应去掉等号"，但该编者注来源不明（可能非缠师本人）。

**代码实现**：使用 `>` 和 `<`（严格不等式）。

**影响分析**：当相邻非包含K线高点或低点恰好相等时：
- 原文逻辑：仍可判定方向（`>=` 成立即为向上）
- 代码逻辑：方向保持不变（不满足 `>` 条件）

**选择时间**：初始实现时选定。编者注"应去掉等号"的原始依据不明，当前代码选择了严格不等式。

**未结算状态**：baohan.md 明确标注此问题仍开放。等号场景在实践中极少出现（包含处理后相邻K线高低点完全相等的概率极低），但概念上未最终结算。

### C3: 初始方向——None -> UP 默认

**原文**：未明确给出初始方向处理方式。第65课的形式化从"第n根与第n-1根不是包含关系"开始，隐含假设在遇到包含关系之前已有方向参考。

**代码实现**：`dir` 初始为 `None`。当遇到包含关系时若 `dir` 仍为 `None`，默认按 `UP` 合并。

**依据**：纯工程选择。必须有一个初始值才能处理序列开头的包含关系。UP 是一个约定，无原文依据。

**影响范围**：仅影响序列最开始若干根K线存在包含关系的场景。在足够长的序列中，初始方向的影响会被后续非包含K线的方向更新覆盖。

**选择时间**：初始实现时选定，无原文依据，baohan.md 明确标注为工程选择。

---

## 结论

三个工程选择（双条件方向判定、严格不等式、初始方向默认UP）均已在代码中稳定运作。其中 C1 已通过数学等价性证明结算，C2 和 C3 在 baohan.md 中标注为未结算/工程选择。本谱系将这些选择从定义文件中的"差异记录"提升为独立可追踪的谱系条目。

## 定义依据

- baohan.md v1.3（已结算）：包含关系定义、合并规则、方向判定、顺序原则
- 缠师第62课（包含关系首次引入）、第65课（形式化补完，方向判定公式）
- 编纂版 四（系统化整理）

## 边界条件

- 若发现双条件与单条件在某种边界场景下产生不同结果（违反当前数学等价性结论），本谱系的 C1 结论需重新审视
- 若找到"应去掉等号"编者注的原始来源（确认为缠师本人），C2 的选择方向可能翻转
- 若发现初始方向选择对实际走势判定产生显著影响的案例，C3 需重新评估

## 下游推论

- 包含处理是管线第一步，其工程选择级联影响分型识别（114号）、笔划分、线段构造
- C1 的数学等价性意味着代码行为与原文一致——这是下游概念正确性的基础
- `merged_to_raw` 映射的正确性依赖于包含处理的正确性

## 谱系引用

- 间接关联 001：包含处理正确性 -> 分型 -> 笔 -> 退化段
- 间接关联 002：编纂版与原始博文的差异（编者注来源不明问题）
- 直接关联 114（fenxing-formalization）：分型建立在包含处理后的序列上

## 影响声明

- **新增文件**: `.chanlun/genealogy/settled/113-baohan-engineering-choices.md`（本文件）
- **DAG 更新**: 新增 113 节点
- **无代码变更**: 本谱系是对已有选择的显式记录，不改变任何实现
