# .chanlun/roadmap.yaml
# 业务目标队列（结构化业务目标载体）
#
# 设计原则（081号谱系）：
#   - 这是 ceremony_scan.py 的最高优先级任务来源
#   - 系统从这里读取待执行的业务目标，无需从叙述性文本猜测
#   - roadmap 为空时，且所有其他 scan_sources 也为空，才触发"干净终止"
#
# 状态值：
#   - active: 当前激活，下次 ceremony 应产生工位
#   - in_progress: 正在执行中
#   - blocked: 有外部阻塞项（填写 blocked_by）
#   - completed: 已完成
#   - deferred: 明确搁置
#
# 来源：078号 D 策略 + Gemini decide + 人类编排者确认

version: "1.3"
genealogy_ref: "081-swarm-continuity-strategy-d"

# 里程碑：定义偏序链全节点实现完毕（2026-02-21）
# baohan→fenxing→bi→xianduan→zhongshu→zoushi→beichi→maimai 全部 ✅
# level_recursion ✅ | 小转大 ✅ | 跨标的(dengjia→bijia→liuzhuan) ✅
# 1435 测试通过 | 92 谱系已结算 | 14 定义已结算

tasks:
  - id: level_recursion
    title: "级别递归概念设计 + 业务验证"
    priority: P2
    status: completed
    completed_date: "2026-02-21"
    completion_note: |
      P1-P9 全部完成，定义 v1.0 已结算。
      RecursiveLevelEngine + RecursiveStack + RecursiveOrchestrator 全部实现。
      106 测试全 GREEN。
    source: "078号D策略（第三步）：元编排v2阶段完成，转向 level_recursion"
    description: |
      设计"级别 = 递归层级（level_id）"的概念形式化。
      从 1分钟K线为底座无限向上递归构造走势类型/中枢。
      禁止用"日线/30分/5分"等时间周期替代级别定义。
    added_by: "078号Gemini decide D策略 + 081号谱系"
    added_date: "2026-02-21"

  - id: real_data_validation
    title: "真实数据端到端验证"
    priority: P1
    status: completed
    completed_date: "2026-02-21"
    completion_note: |
      test_real_data_recursive_e2e.py: 11 passed, 1 skipped。
      RecursiveOrchestrator 在 AAPL 1分钟真实数据上全链路运行无崩溃。
      递归层级、中枢价格区间、事件单调性全部验证通过。
    source: "level_recursion 完成后的自然下游——算法需要在真实市场数据上验证"
    description: |
      用真实 1 分钟 K 线数据端到端验证递归引擎：
      1. 选取代表性品种（如 ES/NQ 期货或 A 股标的）
      2. 全链路运行：K线 → 包含 → 分型 → 笔 → 线段 → 中枢 → 走势 → 递归
      3. 验证递归层级是否合理（预期 4-5 层）
      4. 检查买卖点信号质量
      5. 可视化输出（b_chart / b_plot）
    constraints:
      - "使用口径 A（纯递归），不使用 TF 口径"
      - "数据来源：databento 或本地缓存"
    added_by: "v19-swarm lead（level_recursion完成后自动派生）"
    added_date: "2026-02-21"

  - id: buysellpoint_module
    title: "三类买卖点模块实现"
    priority: P1
    status: completed
    completed_date: "2026-02-21"
    completion_note: |
      a_buysellpoint_v1.py 已实现（336行），79个测试全GREEN。
      三类买卖点全部覆盖。maimai.md 中"0%覆盖"是过期信息，已修正。
    source: "定义偏序自然派生：maimai.md 定义已结算但代码 0% 覆盖"
    description: |
      实现缠论三类买卖点识别模块（maimai.md 的代码化）：
      1. 第一类买卖点：趋势背驰 → 走势终结点（复用 Divergence(kind="trend")）
      2. 第二类买卖点：第一类后首个次级别回调/反弹结束点
      3. 第三类买卖点：中枢离开段 + 回试段 + ZG/ZD比较
      前置依赖全部就绪：背驰(beichi)、走势类型(zoushi)、中枢(zhongshu)、级别递归(level_recursion)
    constraints:
      - "严格遵循 maimai.md 定义（已结算）"
      - "买卖点判定基于递归级别（口径A），不使用时间周期"
      - "第一类买卖点 = 趋势背驰确认点（不含盘整背驰）"
      - "第三类买卖点仅限第一次离开-回试"
    definition_ref: ".chanlun/definitions/maimai.md"
    genealogy_refs:
      - "定义偏序: maimai depends_on [beichi]"
    added_by: "v19-swarm lead（real_data_validation完成后自动派生）"
    added_date: "2026-02-21"

  - id: xiaozhuan_da
    title: "小转大机制实现（跨级别联动）"
    priority: P1
    status: completed
    completed_date: "2026-02-21"
    completion_note: |
      a_xiaozhuan_da.py 已实现，11个测试全GREEN。
      beichi.md 小转大标记从 ❌ → ✅。
    source: "定义偏序派生：beichi.md 中'小转大❌未实现'，RecursiveStack就绪后可实现"
    description: |
      实现缠论"小转大"机制：
      - 小级别趋势背驰未触及大级别买卖点时，次级别回调/反弹终结走势
      - 需要 RecursiveStack 提供多级别同时在线的中枢和走势数据
      - 与第二类买卖点紧密相关（小转大 = 2B 的一种来源）
      前置依赖：RecursiveStack(✅) + BuySellPoint(✅) + Divergence(✅)
    constraints:
      - "跨级别联动必须通过 RecursiveStack，不可硬编码级别映射"
      - "小转大是走势完成的充分非必要条件（beichi #3 已结算）"
    definition_ref: ".chanlun/definitions/beichi.md"
    added_by: "v20-swarm lead（定义偏序扫描自动派生）"
    added_date: "2026-02-21"

  - id: definition_status_sync
    title: "定义文件实现状态同步"
    priority: P2
    status: completed
    completed_date: "2026-02-21"
    completion_note: |
      def-sync 工位完成：beichi/maimai/zoushi 过期标记全部修正。
    source: "多处定义文件中的'尚未实现'标记已过期，需批量更新"
    description: |
      批量更新定义文件中过期的实现状态标记：
      - maimai.md 行373: "买卖点模块（尚未实现）" → 已实现
      - beichi.md 行458/460: "买卖点/区间套（尚未创建）" → 已创建
      - zoushi.md 行347/348: "级别/区间套（尚未创建）" → 已创建
    added_by: "v20-swarm lead（定义文件扫描发现）"
    added_date: "2026-02-21"
