{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://newchanlun.local/schemas/contradiction-object.schema.json",
  "title": "Contradiction Object",
  "description": "双螺旋架构中的否定对象 — Gemini/人类/CI 发现矛盾后注入 Claude 工作区的结构化否定。遵循 005b 语法规则：对象否定对象。",
  "type": "object",
  "required": [
    "id",
    "source",
    "target",
    "contradiction_type",
    "description",
    "evidence",
    "severity",
    "resolution_status",
    "created_at"
  ],
  "additionalProperties": false,
  "properties": {
    "id": {
      "type": "string",
      "pattern": "^CO-\\d{4}-\\d{2}-\\d{2}-\\d{3}$",
      "description": "唯一标识，格式：CO-YYYY-MM-DD-NNN",
      "examples": ["CO-2026-02-20-001"]
    },
    "source": {
      "type": "string",
      "enum": ["gemini-3.1-pro-preview", "human", "ci"],
      "description": "否定来源 — 谁发现了这个矛盾"
    },
    "target": {
      "type": "object",
      "description": "被否定的对象",
      "required": ["type", "ref"],
      "additionalProperties": false,
      "properties": {
        "type": {
          "type": "string",
          "enum": ["commit", "genealogy", "definition"],
          "description": "被否定对象的类型"
        },
        "ref": {
          "type": "string",
          "description": "被否定对象的引用（commit hash / 谱系编号如 '055' / 定义名如 'baohan'）",
          "minLength": 1
        }
      }
    },
    "contradiction_type": {
      "type": "string",
      "enum": [
        "logical-break",
        "circular-reference",
        "ontology-violation",
        "definition-conflict"
      ],
      "description": "矛盾类型：逻辑断裂 / 循环引用 / 本体论违规（005b语法违规等）/ 定义冲突"
    },
    "description": {
      "type": "string",
      "minLength": 10,
      "description": "矛盾的自然语言描述 — 什么跟什么冲突、为什么不可弥合"
    },
    "evidence": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": ["type", "content"],
        "additionalProperties": false,
        "properties": {
          "type": {
            "type": "string",
            "enum": ["diff", "genealogy-ref", "definition-quote", "test-output"],
            "description": "证据类型"
          },
          "content": {
            "type": "string",
            "minLength": 1,
            "description": "证据内容（diff 片段 / 谱系编号 / 定义原文引用 / 测试输出）"
          }
        }
      },
      "description": "支撑矛盾判断的证据列表，至少一条"
    },
    "severity": {
      "type": "string",
      "enum": ["block", "warn"],
      "description": "block = 阻断 commit，Claude 必须先处理；warn = 允许 commit 但记录待处理"
    },
    "resolution_status": {
      "type": "string",
      "enum": ["pending", "resolved", "overridden"],
      "description": "pending = 待处理；resolved = Claude 已修复矛盾；overridden = 人类 INTERRUPT 覆盖"
    },
    "genealogy_refs": {
      "type": "array",
      "items": {
        "type": "string",
        "pattern": "^\\d{3}[a-z]?$",
        "description": "谱系编号，如 '005b'、'055'"
      },
      "default": [],
      "description": "关联谱系编号列表"
    },
    "created_at": {
      "type": "string",
      "format": "date-time",
      "description": "矛盾对象创建时间（ISO 8601）"
    },
    "resolved_at": {
      "type": ["string", "null"],
      "format": "date-time",
      "default": null,
      "description": "矛盾解决时间（resolved/overridden 时填写）"
    },
    "resolution_note": {
      "type": ["string", "null"],
      "default": null,
      "description": "解决说明 — 如何修复的、或为什么被覆盖"
    }
  }
}
