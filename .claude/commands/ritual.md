# /ritual — 定义广播仪式

**分离是自治的，结算是仪式。** 无论变更来源是编排者决断还是蜂群实证结果，概念结算都通过本命令完成。

## 用法

```
/ritual [新定义描述]
```

三种触发场景（按四分法过滤）：
1. **选择类决断完成后** — `/escalate` 上浮的矛盾经裁决后，调用 `/ritual` 写入新定义
2. **语法记录辨认完成后** — 已在运作的隐性规则经辨认后，调用 `/ritual` 显式化
3. **蜂群实证结算（非定理类）** — 自治分离后实证结果明确且属于选择/语法记录类，调用 `/ritual`

**注意**：定理类（已结算原则的逻辑必然推论）自动结算，写谱系但不走 `/ritual`。

## 执行步骤

1. **写入新定义** — 将概念决断翻译为标准格式，写入知识仓库：
   - 如果是域对象定义变更 → 更新 `definitions.yaml`
   - 如果是规则规范变更 → 更新 `docs/spec/` 中的对应文件
   - 如果是基础概念变更 → 更新 `缠论知识库.md`
2. **写入谱系** — 记录这次概念分离到 `.chanlun/genealogy/settled/`：
   - 从哪个矛盾中来
   - 否定了什么旧定义
   - 新定义是什么
   - 分离的逻辑必然性（为什么必须这样分，不是"我觉得这样好"）
3. **回溯扫描** — 检查 `.chanlun/genealogy/pending/` 中所有生成态矛盾：
   - 新定义是否解决了某些旧矛盾？
   - 如果能解决，执行回溯结算，将记录从 `pending/` 移到 `settled/`
   - 如果提供了新理解但尚不能完全解决，记录新理解但保持生成态
4. **基底刷新通知** — 输出变更摘要：
   - 新增/修改了哪些定义
   - 否定了哪些旧定义
   - 回溯结算了哪些矛盾
   - 哪些正在进行的工作需要在新基底上重新质询

## 输出格式

```markdown
## 仪式完成

### 新定义
- [定义名]：[内容]
- 来源矛盾：[GEN-XXX]

### 被否定的旧定义
- [旧定义名]：[内容]
- 否定原因：[逻辑必然性说明]

### 回溯结算
- [GEN-XXX]：已结算（被新定义 [名称] 解决）
- [GEN-YYY]：更新理解但保持生成态

### 基底刷新
以下工作的产出已退回生成态，需要在新基底上重新质询：
- [列出受影响的模块/任务]
```

## 元层覆盖

`/ritual` 同时覆盖域层和元层。仪式的四步骤（写入定义、写入谱系、回溯扫描、基底刷新）在两个层面完全相同。

### 写入目标扩展

| 变更类型 | 写入目标 | 示例 |
|----------|---------|------|
| 域对象定义 | `definitions.yaml` / `.chanlun/definitions/*.md` | 笔的包含关系规则 |
| 规则规范 | `docs/spec/*.md` | 线段划分规则 |
| 基础概念 | `缠论知识库.md` | 走势必完美 |
| **元编排核心卡** | **`SKILL.md`** | 质询序列修正 |
| **agent 定义** | **`.claude/agents/*.md`** | 工位职责调整 |
| **全局原则** | **`CLAUDE.md`** | 元编排原则修正 |
| **命令定义** | **`.claude/commands/*.md`** | 本命令自身的修正 |

### 四分法过滤器（018号谱系）

不是所有元层变更都走完整仪式：

| 产出类型 | 仪式要求 | 说明 |
|----------|---------|------|
| **定理** | 不走仪式，但写谱系 | 已结算原则的逻辑必然推论 |
| **选择** | **走 /ritual** | 多种合理方案，需编排者决断 |
| **语法记录** | **走 /ritual** | 已在运作的隐性规则显式化 |
| **行动** | 不走仪式，不写谱系 | 版本升级、状态迁移等操作性事件 |

### 元层仪式的自指性

元层仪式改的是仪式自身的规则——这是自指性。回退链终止于编排者授权（005b：语法规则不能自我奠基）。仪式不是外加的制动，是系统通过编排者完成的收缩相位（020号谱系）。

## 注意

- 定理类自动结算（写谱系不走 `/ritual`）；选择和语法记录类经 `/escalate` 上浮后走 `/ritual`
- 被退回生成态的产出不是被删除，而是等待在新基底上重新验证
- 自治分离（写入 `pending/`、写入知识库中的分离概念）不需要 `/ritual`，那是分离流程自身的步骤
- 元层变更经 `/ritual` 结算后，Lead 在下一轮轴线汇报中标注受影响的工位
