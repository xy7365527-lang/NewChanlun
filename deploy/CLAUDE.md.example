# 缠论量化交易系统

## 项目描述

基于缠论（Chanlun）理论的量化交易程序。目标是将缠论的完全分类体系形式化为可执行代码。

编排者是缠论领域专家，使用缠论术语进行交流。概念层的决断由编排者做出，实现层由lead自主结算。

## 当前阶段目标

[在此填写当前阶段的具体目标，例如：]
[完成笔的形式化定义，通过历史K线数据的质询验证]

## 技术栈

- 语言：Python
- 框架：[待定]
- 数据源：[待定]

## 项目结构

```
.chanlun/
├── definitions/     # 缠论概念定义仓库（由 /ritual 维护，编排者确认后写入）
└── genealogy/       # 谱系记录（由 /ritual、/inquire、lead自主结算 维护）
```

## 编排规则

本项目使用元编排 v3.2 方法论。以下规则始终生效：

1. **概念优先于代码。** 定义不清楚时不写代码。
2. **不绕过矛盾。** 见 `~/.claude/rules/no-workaround.md`。
3. **所有产出必须可质询。** 见 `~/.claude/rules/result-package.md`。
4. **谱系必须维护。** 每次矛盾处理后写入 `.chanlun/genealogy/`。
5. **定义变更必须通过仪式。** 概念定义的任何修改需编排者确认后执行 `/ritual`。
6. **系统开端后自转。** lead自主处理实现层事务，只在概念层转折点请求编排者决断。
7. **区分定理、选择和语法记录。** 定理（逻辑推论）由lead自动结算。选择（开放性决策）上浮请求编排者决断。语法记录（已在实践中运作的规则）上浮请求编排者辨认——辨认和决断是不同的行为。

## Agent Teams 工作模式

本项目使用 Agent Teams 模式。需要启用：

```bash
export CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS=1
```

或在 settings.json 中设置。

### 角色分工
- **编排者（你）：** 用缠论术语下任务、在概念层转折点做决断、确认或否决lead的建议方案
- **Lead：** 项目经理。分配任务、监控质询循环、谱系比对（第四步）、自主结算实现层、上浮概念层矛盾（附建议方案）
- **Teammates：** 各自负责具体模块的实现和互相质询（第一至三步）

### 自主权分配（v3核心）
- Teammates自行解决实现层分歧
- Lead区分三类待结算问题：定理（自动结算）、选择（上浮请求决断）、语法记录（上浮请求辨认）
- Lead自主结算实现层（质询通过、代码走通）和定理（逻辑推论），直接写入谱系
- 选择和语法记录由lead附带建议方案/观察报告上浮给编排者
- 编排者对选择做决断，对语法记录做辨认——两种行为性质不同
- **编排者不需要全程在线——系统在两个概念层转折点之间自转**

### 质询分工
- Teammates之间通过SendMessage互相质询（定义回溯、反例构造、推论检验）
- 并行劳动产生的认知分化让质询有实质内容
- 概念层矛盾上报lead → lead做谱系比对 → 附带建议方案上浮给编排者
- 实现层分歧teammates自行解决或lead仲裁

### 定义共享
- 所有teammates自动加载本文件、rules、skills
- 定义文件在 `.chanlun/definitions/`，所有teammates通过文件系统共享
- `/ritual` 写入新定义后，lead通过SendMessage通知受影响的teammates

## 可用命令

- `/ceremony` — 开端（创世仪式，会话启动时执行，系统从此开始自转）
- `/inquire` — 对产出执行四步质询
- `/escalate` — 矛盾上浮（生成矛盾报告，含lead建议方案）
- `/ritual` — 仪式（编排者做概念层决断后执行，收缩的顶点）
- `/plan` — 实现规划（来自 ECC，受元编排规则约束）
- `/tdd` — 测试驱动开发（来自 ECC，受元编排规则约束）
- `/code-review` — 代码审查（来自 ECC，受元编排规则约束）
- `/build-fix` — 构建错误修复（来自 ECC）
- `/refactor-clean` — 死代码清理（来自 ECC）
