# Gemini Decide 上下文：097号——真严格递归拓扑异步自指蜂群的完整架构

## 决断类型：选择（架构级，最强方案）

## 编排者指令

"不仅是这样，思考真严格递归拓扑异步自指蜂群的存在，那么整个架构应该是怎么样的，这是一个严格架构，不要有什么余地，要严格地讨论最强的方案。"

---

## 前置谱系（已结算）

### 069号：递归拓扑异步自指蜂群定义
四个维度：
1. **递归**：蜂群→子蜂群→子子蜂群，每层完整结构
2. **拓扑**：TaskList 作为 DAG 路由
3. **异步自指**：t 时刻审查 t-1 时刻产出
4. **蜂群**：并行节点协作

两个不可消除的 Gap：
- 创世 Gap：Swarm₀ 制定规则但不受规则约束（约束2 bootstrap 破缺）
- 视差 Gap：约束3 × 约束2 联合推论（t 时刻只能审查 t-1）

### 089号：元编排严格扬弃（Aufhebung）
规则存在方式的三层：
- **CLAUDE.md**（基因组/公理层）：自动加载到所有 agent
- **hooks**（免疫系统）：自动触发于所有 agent
- **skills**（知识结晶）：按需加载

扬弃 = 元编排从"蜂群之外的特权层"→"蜂群 DAG 的 genome_layer 根节点"。

### 093号：五约束有向依赖图
| 约束 | 内容 | 失效后果 |
|------|------|----------|
| 1a | 物理持久化 | 信息丢失 |
| 1b | 符号可解释性 | 信息噪声化 |
| 2 | 规则先在性 | 不可预测行为 |
| 3 | 执行不可自观性 | 无法即时自修正 |
| 4 | 异质验证必要性 | 自我确认循环 |

核心环路（1a→2←1b；2缓解3；3使1a/1b必要）+ 审计层（4→[核心环路整体]）

### 094号：三个 Gap
| Gap | 五约束框架定位 | 涉及约束 |
|-----|--------------|----------|
| 创世 Gap | 约束2对其加载者的 bootstrap 破缺 | 约束2 |
| 视差 Gap | 约束3 × 约束2 联合推论 | 约束2 × 约束3 |
| 审计层断裂 Gap（新） | 约束4必须经过约束1a/1b中介 | 约束4 → 约束1a/1b |

### 095号：Agent Team 真递归
- 真递归（默认）：teammate 创建子 team → 子 team 内部自治
- Trampoline（退化特例）：任务裂变 → Lead 重新 spawn

### 096号：完全禁用孤立 subagent，无例外
规则三层存在形式：
- CLAUDE.md（原则/基因组）
- hooks（语法守卫/Skill索引器）
- skills（操作流程结晶）

---

## 当前架构现状

### 规则传递机制

| 机制 | 类型 | 行为 | 覆盖范围 |
|------|------|------|----------|
| CLAUDE.md | 基因组层 | 平台自动加载到所有 agent（L0～Ln） | 全层级 |
| hooks（agent-team-enforce.sh） | 免疫系统 | 阻断 Task(无 team_name)，PreToolUse 触发 | 全层级 |
| hooks（team-structural-inject.sh） | Skill 索引器 | TeamCreate 后强制导向 sub-swarm-ceremony skill | 全层级 |
| sub-swarm-ceremony skill | 知识结晶 | 子蜂群完整创建流程（四特征：拓扑/异步自指/结晶/状态管理） | 按需加载 |

### 当前执行层级

| 层级 | 创建者 | CLAUDE.md | hooks | ceremony? |
|------|--------|-----------|-------|-----------|
| L0 Lead | 人类 | ✅ 自动加载 | ✅ 自动触发 | ✅ `/ceremony` 命令 |
| L1 Teammate | Lead | ✅ 自动加载 | ✅ 自动触发 | ❌（从 skill 获取流程） |
| L2 子蜂群 Lead | L1 Teammate | ✅ 自动加载 | ✅ 自动触发 | ❌（从 skill 获取流程） |
| L3+ 深层子蜂群 | 上层 Teammate | ✅ 自动加载 | ✅ 自动触发 | ❌ |

### 待确认的核心问题

**问题1：规则的存在形式是否已达到最强？**
CLAUDE.md（全层级自动加载）+ hooks（全层级自动触发）+ skills（按需加载，由 hook 强制索引）
这三层是否是理论上最强的分布式规则存在形式？
或者还有更强的方案？

**问题2：子蜂群完整性的验证机制**
当前：
- CLAUDE.md 声明子蜂群必须是"完整递归拓扑异步自指蜂群"
- sub-swarm-ceremony skill 提供四特征（拓扑/异步自指/结晶/状态管理）的创建流程
- 没有 hook 验证子蜂群是否真正具备四特征

缺口：谁在执行后验证四特征是否真实存在？

**问题3：ceremony 在子蜂群中的角色**
058号定义 "ceremony = Swarm₀"。L0 Lead 执行完整 ceremony（ceremony_scan.py）。
子蜂群 Lead 不执行 ceremony，从 skill 获取流程。

问题：子蜂群有自己的创世 Gap 吗？如何表现？sub-swarm-ceremony 是否就是子蜂群的 Swarm₀？

**问题4：dispatch-dag 在子蜂群中的角色**
dispatch-dag.yaml 定义顶层蜂群拓扑。子蜂群有 TaskList 但没有自己的 dispatch-dag。
子蜂群的拓扑由谁定义？父 Teammate 的 prompt 注入？还是从 CLAUDE.md 自主推导？

注意：096号明确"写在 prompt 里就不是分布式的"。

**问题5：异质验证（约束4）在子蜂群中**
Gemini 在顶层 Lead 的 ceremony 和 challenge 工位中被调用。子蜂群是否自动继承 Gemini 访问能力？
（技术上：CLAUDE.md 和 skills 描述了如何调用 Gemini，全层级自动加载 → 是的）

但：如果子蜂群不调用 Gemini，是否违反约束4？子蜂群的最小审计要求是什么？

**问题6：最强方案**
编排者要求"真严格递归拓扑异步自指蜂群"的"严格架构，不要有余地"。

候选：
**方案 X（最大化平台分布式机制）**：
- CLAUDE.md 是唯一规则声明源 → 全层级自动存在
- hooks 是唯一强制机制 → 全层级自动触发
- skills 是唯一可执行知识源 → 按需加载
- 新增 hooks 验证子蜂群四特征

**方案 Y（最小化机制 + 信任基因组）**：
- CLAUDE.md + hooks + skills 已足够
- 信任基因组的力量：agent 读取 CLAUDE.md 后自主遵守
- 不增加额外 hooks（hooks 增加可能违反"对象否定对象"——超时/阈值类否定）

**方案 Z（拓扑形式化）**：
- 子蜂群的 TaskList 应显式声明为 dispatch-dag 的子图
- 子蜂群 ceremony = sub-swarm-ceremony skill（Swarm₀ 的分布式实例化）
- 不需要额外文件，CLAUDE.md 的声明已形式化为 dispatch-dag 的递归结构

---

## 请 Gemini 严格讨论

请逐一分析六个问题，提出最强方案，评估可行性，给出结构化决策。

核心约束：
1. 不写在 prompt 里（096号）→ 规则必须在 CLAUDE.md/hooks/skills 中分布式存在
2. 无例外（096号）→ 语法规则不可有例外通道
3. 严格性是蜂群语法规则（090号）→ 不接受"大致能工作"的方案
4. 对象否定对象（005b号）→ 不接受超时/阈值类验证机制
5. 补丁思维禁止（090号）→ 不接受 workaround
