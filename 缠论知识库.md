## 缠论知识库（程序实现版）

> 目标：把“缠中说禅”技术理论中**可落地编码的定义/定理/流程**提炼成一份小而全的 Markdown，供 Claude Code / Cursor 引用，避免直接引用超大 PDF 导致 `prompt is too long`。

---

## 0. 来源与可读性说明

- **主要来源（可直接读取的文字版）**：`docs/chanlun/mineru/缠中说禅-股市技术理论/full.md`（很大，不建议整本引用）
- **原文拆分（推荐引用）**：`docs/chanlun/text/chan99/`（入口：`docs/chanlun/text/chan99/INDEX.md`）
- **两份思维导图（已文字转写，推荐引用）**：`docs/chanlun/text/mindmaps/`（入口：`docs/chanlun/text/mindmaps/INDEX.md`；原图仍在 `docs/chanlun/mineru/**/images/`）

> **权威性声明**：本知识库以《股市技术理论》原文为准。思维导图属于第三方总结/讲解，可能存在简化、口径差异甚至笔误；凡与原文冲突处，**一律以原文为准**（必要时回溯 `docs/chanlun/text/chan99/` 对应章节）。

---

## 1. 快速索引（给 CC 用）

### 1.0 使用建议（避免 prompt is too long）

- **不要**一次性引用整本 `docs/chanlun/mineru/**/full.md` 或 PDF；优先引用已拆分的小文件。
- 若你不想记路径：直接提问并要求“在仓库内搜索/按需引用”，让工具去找最相关的小文件即可。
- 常用入口：
  - 速查/可编码定义：本文件 `缠论知识库.md`
  - 《股市技术理论》拆分原文：`docs/chanlun/text/chan99/INDEX.md`
  - 思维导图文字版：`docs/chanlun/text/mindmaps/INDEX.md`

- **K线包含处理**：2
- **分型（顶/底）**：3
- **笔（含划分步骤）**：4
- **线段（特征序列法）**：5
- **走势中枢（含中心定理）**：6
- **走势类型（盘整/趋势/上涨/下跌）与延续**：7
- **走势必完美 & 走势分解（结合律/多义性）**：8
- **背驰 / 盘整背驰 & MACD 辅助**：9
- **三类买卖点 + 定律/定理**：10
- **区间套（逐级收缩定位转折）**：11

---

## 2. K线包含关系（合并规则）

### 2.1 定义

- **K线包含关系**：一根K线的高低点区间完全在另一根K线范围内。
- （入门补充）在缠论的包含/分型/笔等处理里，K线通常只关心两个价位：**最高价**与**最低价**。

### 2.2 合并方向的确定（关键）

假设第 \(n\) 根与第 \(n+1\) 根存在包含关系，且第 \(n\) 根与第 \(n-1\) 根不存在包含关系：

- 若 \(high_n > high_{n-1}\) → 认为 \((n-1,n,n+1)\) **向上**（向上包含）
- 若 \(low_n < low_{n-1}\) → 认为 \((n-1,n,n+1)\) **向下**（向下包含）

### 2.3 合并后的高低点

- **向上包含**：新K线 \(high = max(high_1, high_2)\)，\(low = max(low_1, low_2)\)
- **向下包含**：新K线 \(high = min(high_1, high_2)\)，\(low = min(low_1, low_2)\)

### 2.4 顺序原则（非常重要）

- **先左后右**：先用第1、2根合并得到新K线，再用“新K线”和第3根比较；若仍包含继续合并，否则按正常K线继续。
- **性质**：包含处理遵守**结合律**，但不遵守**传递律**（2含3 且 3含4，不代表2含4）。

---

## 3. 分型（顶/底）

> 分型必须在“包含处理后的K线序列”上判定。

### 3.1 顶分型

- 三根相邻K线中：**第二根**的
  - 高点是三者中最高
  - 低点也是三者中最高

### 3.2 底分型

- 三根相邻K线中：**第二根**的
  - 低点是三者中最低
  - 高点也是三者中最低

### 3.3 基本结论

- 没有顶分型 → 没有顶
- 没有底分型 → 没有底

---

## 4. 笔（由分型构成）

### 4.1 定义

- **笔**：两个相邻的顶与底之间构成一笔（忽略其中其他波动）。
- **上升笔**：底分型 + 上升K线 + 顶分型
- **下降笔**：顶分型 + 下降K线 + 底分型

### 4.2 笔的规范要求

1. 必须是一顶一底（顶对应底、底对应顶）
2. 顶与底之间至少有一根K线不属于顶分型与底分型
3. 同一笔中：顶分型最高那根K线的区间，至少有一部分高于底分型最低那根K线的区间（否则“顶在底里/顶比底低”，不可接受）

> 书中给出的一个实用结论：**笔至少由包含顶底在内的 5 根K线构成**（顶底间必须至少一根K线）。

### 4.3 划分笔的步骤（可直接编码）

1. 找出所有符合标准的分型（若存在包含关系，先做包含处理）
2. 若相邻两分型同性质：
   - 顶：前一个顶 < 后一个顶 → **只保留后一个顶**（前一个 X 掉）
   - 底：前一个底 > 后一个底 → **只保留后一个底**（前一个 X 掉）
   - 其他情况（例如相等）可先保留
3. 经过步骤2处理后，剩余分型若相邻为“顶-底”或“底-顶”，即可连接为一笔

---

## 5. 线段（由笔构成，特征序列法）

### 5.1 定义

- **线段**：至少由三笔组成，且**前三笔必须有重叠部分**。
- **线段划分定理**：线段被终结，当且仅当至少被“有重叠部分的连续三笔”中的某一笔终结；只要前三笔构成重叠，必然形成线段。  
  换言之：**原线段终结的充要条件 = 新线段形成**。

### 5.2 线段的一些性质

- 线段分两类：从向上一笔开始 / 从向下一笔开始；其方向与起始笔一致
- 从顶分型开始的线段，终结一定是底分型；反之亦然 → 构成线段的笔数是**奇数**

### 5.3 特征序列（核心）

用 S 表示向上笔，X 表示向下笔。

- 若线段从向上笔开始：笔序列为 `S1 X1 S2 X2 ... Sn Xn`  
  其**特征序列**取 `X1 X2 ... Xn`
- 若线段从向下笔开始：笔序列为 `X1 S1 X2 S2 ... Xn Sn`  
  其**特征序列**取 `S1 S2 ... Sn`

特征序列两相邻元素间**没有重合区间**称为该序列的一个**缺口**。

### 5.4 标准特征序列（把元素当K线做包含处理）

把特征序列的每个元素当成一根“K线”，按 **K线包含关系** 做“非包含处理”，得到 **标准特征序列**。

### 5.5 线段划分的程序（建议实现路径）

推荐实现思路（更易工程化）：

1. 构造线段的特征序列
2. 将特征序列元素当K线做包含处理 → 得到标准特征序列
3. 在标准特征序列上按分型定义找顶/底分型  
   - 线段从向上笔开始 → 只考察**顶分型**  
   - 线段从向下笔开始 → 只考察**底分型**
4. 一旦标准特征序列中出现可形成“新线段”的分型结构 → **新线段形成，旧线段终结**；否则旧线段延续

### 5.6 入门补充：线段确认/延续/规则（来自思维导图）

- **线段确认**：新线段生成才能确认前线段完成
- **线段延续**：新线段未生成前，前线段为延续状态
- **线段规则**（两种常见划分口径）
  - 按高低点划分：遵从高低点，且前三笔有重叠即可划分为线段
  - 按特征序列划分：推荐工程实现（见 5.3-5.5）

---

## 6. 走势中枢（Center）

### 6.1 定义

- **走势中枢**：某级别走势类型中，被至少三个连续次级别走势类型所重叠的部分。  
  典型形态：下-上-下 或 上-下-上。

### 6.2 三个中枢定理（直接用）

1. **趋势中**：连接两个同级别中枢的必然是**次级别以下**的走势类型
2. **盘整中**：离开或返回中枢的走势类型必然是**次级别以下**的
3. **中枢终结（破坏）条件**：某级别中枢终结，当且仅当一个次级别走势离开该中枢后，其后的次级别回抽走势**不重新回到**该中枢内

### 6.3 中枢区间（以原文为准）

- 原文明确：走势中枢由“**前三个连续次级别走势类型的重叠部分**”确定，并据此构造 \([ZD, ZG]\)（见 `docs/chanlun/text/chan99/0010-第八节 走势中枢.md`）。
- 你可能在一些思维导图/讲解里见到“用所有构筑段的重叠去收窄区间、以便更早识别三买”等做法：这属于**实战归纳/变体口径**，不应覆盖原文的严格定义；工程实现若需变体，请显式标注为 `variant`，且默认仍以原文口径为主。

### 6.4 中枢区间与指标（工程上常用）

与中枢形成方向一致的次级别走势类型称为 **Z走势段**。按时间顺序记录为 \(Z_n\)，其高低点记为 \(g_n, d_n\)：

- \(GG = max(g_n)\)
- \(G = min(g_n)\)
- \(D = max(d_n)\)
- \(DD = min(d_n)\)

再定义（由前两段确定的中枢区间）：

- \(ZG = min(g_1, g_2)\)
- \(ZD = max(d_1, d_2)\)

则 \([ZD, ZG]\) 为走势中枢区间。

### 6.5 中枢中心定理（两条）

1. **中心定理一（延伸）**：中枢延伸 \(\Leftrightarrow\) 任意区间 \([d_n, g_n]\) 与 \([ZD, ZG]\) 有重叠  
   若存在 \(Z_n\) 使得 \(d_n > ZG\) 或 \(g_n < ZD\) → 必然产生**更高级别中枢**或**趋势及其延续**
2. **中心定理二（两个同级别中枢的关系）**：
   - 后 \(GG <\) 前 \(DD\) → 下跌及其延续
   - 后 \(DD >\) 前 \(GG\) → 上涨及其延续
   - 后 \(ZG <\) 前 \(ZD\) 且 后 \(GG \ge\) 前 \(DD\)，或 后 \(ZD >\) 前 \(ZG\) 且 后 \(DD \le\) 前 \(GG\) → 形成更高级别中枢

### 6.6 导图/讲解性补充（非原文严格概念）

- “中枢引力/能量越大越难脱离”等表述，更多是对中枢震荡现象的形象化解释；原文并未把它作为可计算的定理/指标。若在项目里使用，建议作为注释/直观解释，而非算法依据。

### 6.7 中枢三种“发展”

- **延伸**：继续围绕 \([ZD,ZG]\) 重叠震荡（表现为盘整）
- **新生**：形成趋势
- **扩展**：形成更高级别中枢

---

## 7. 走势与走势类型

### 7.1 基本定义

- **走势**：打开走势图看到的就是走势，走势分不同级别
- 任意级别的走势类型只有两类：**盘整** 与 **趋势**（趋势再分上涨/下跌）
- **盘整**：某完成走势类型只包含 **1 个** 走势中枢
- **趋势**：某完成走势类型至少包含 **2 个以上** 依次同向的走势中枢  
  - 向上：上涨；向下：下跌

### 7.2 走势级别延续定理

1. 在更大级别中枢产生前，该级别走势类型将延续（只能是该级别盘整或趋势的延续）
2. 更大级别中枢产生，当且仅当围绕连续两个同级别中枢产生的波动区间产生重叠

### 7.3 级别（本项目口径：从 1 分钟K线无限向上递归）

> 重要：本项目里**级别 = 递归层级**，不是“日线/30分/5分”这类时间周期。

- **时间周期**：只是图表/数据的采样与展示方式；把 1分钟聚合成 5分钟/30分钟会丢信息，不能作为严格的级别定义。
- **级别定义**：级别由走势组件（**次级别走势类型**）递归构成；最小的“走势类型”必须有中枢。
- **本项目确定级别的基本策略**：
  1. 以 **1分钟K线** 为唯一底座，做包含处理 → 分型 → 笔 → 线段 → 次级别走势类型 / 中枢
  2. 以“**三个连续次级别走势类型重叠**”为核心规则，持续向上构造更高级别的走势类型/中枢（理论上可无限递归，实际受数据长度限制）
  3. 在已经向上构造出的层级树上，采用**自上而下**的方式去“确立”哪些次级别走势类型组合能形成**确定的标准中枢**（用来压制多义性/保证唯一口径）
  4. 因而对外描述“某标的的级别”时，优先用“第 \(L\) 层/第 \(k\) 次递归（level_id）”这种内部级别标识，而不是用时间周期替代

> 实务提示：如果你需要“把级别映射成可读名称”，建议在代码里维护一个 `level_id -> name` 的映射（例如 `L0/L1/L2...`），并确保所有算法只依赖 `level_id` 而非 K 线时间周期。

---

## 8. 走势必完美 & 走势分解（唯一分解）

- **技术分析基本原理一**：任何级别的任何走势类型终要完成（走势终完美）
- **走势分解定理一**：任何级别的任何走势，都可分解为同级别的“盘整/下跌/上涨”三类走势类型的连接
- **走势分解定理二**：任何级别的任何走势类型，至少由三段以上次级别走势类型构成
- **结合律**：走势类型连接符合结合律，但不符合交换律 → 允许在不改变逻辑的前提下“重新组合”帮助当下判断
- **多义性**：不是胡乱分解，而是基于结合律的多视角释义；工程上常用的是“同级别分解”（唯一性更强、便于机械化）

---

## 9. 力度、背驰、盘整背驰（含 MACD 辅助）

### 9.1 概念

- **背驰**：趋势力度比上一次趋势力度弱 → 力量衰竭
- **盘整背驰**：盘整中，当下笔/线段力度比前一笔/线段弱
- **关键**：没有趋势，就没有背驰；盘整里只谈盘整背驰

### 9.2 背驰与买卖点

- **背驰-买卖点定理**：任一背驰都必然制造某级别买卖点；任一级别买卖点都必然源自某级别走势的背驰

### 9.3 MACD 辅助判断（工程上常用简化）

用 MACD 判断背驰的常用框架：

1. 需要两段同向趋势，中间有盘整或反向趋势连接，称 A、B、C 段
2. B 段的中枢级别通常比 A、C 更大（否则三段会合并成更大趋势/中枢）
3. C 段完成时，对应的 MACD 柱子面积（上看红柱、下看绿柱）**小于** A 段对应面积 → 标准背驰
4. 标准背驰后的回拉，至少会重新回到 B 段对应的走势中枢

---

## 10. 三类买卖点（定义 + 定律/定理）

> 下述定义以“某级别”讨论，核心都是“与该级别最近的走势中枢的关系”。

### 10.1 定义（书中版本）

- **第一类买点**：某级别下跌趋势中，次级别走势向下跌破最后一个中枢后形成的**背驰点**
- **第一类卖点**：某级别上涨趋势中，次级别走势向上突破最后一个中枢后形成的**背驰点**
- **第二类买点**：第一类买点后，次级别上涨结束，再次下跌的那个次级别走势的结束点
- **第二类卖点**：第一类卖点后，次级别下跌结束，再次上涨的那个次级别走势的结束点
- **第三类买点**：上涨趋势中，次级别走势向上离开中枢后，次级别回抽低点**不跌破 ZG** 的中枢终结点
- **第三类卖点**：下跌趋势中，次级别走势向下离开中枢后，次级别回抽高点**不升破 ZD** 的中枢终结点  
  （注：工程上以 \([ZD,ZG]\) 中 **ZD 为下边界**、**ZG 为上边界** 为准）

### 10.2 关键定律/定理（常用）

- **买卖点定律一**：任何级别的第二类买卖点都由次级别相应走势的第一类买卖点构成
- **趋势转折定律**：任何级别的上涨转折由某级别第一类卖点构成；下跌转折由某级别第一类买点构成
- **买卖点完备性定理**：市场必然产生赢利买卖点，只有第一、二、三类
- **升跌完备性定理**：市场中任何向上/向下，都必然从三类买卖点之一开始并结束

### 10.3 两个实用提醒

- **只有下跌趋势确立后的中枢下方才可能出现“第一类买点”**（第一类卖点反之）
- **第三类买卖点必须是“第一次回抽”**，并非任意回调都算

---

## 11. 区间套（逐级定位大转折）

### 11.1 定义

- **区间套**：根据背驰段，从大级别向小级别逐级寻找背驰点（即买卖点）的方法。
- **精确大转折点寻找程序定理**：某大级别转折点，可通过不同级别背驰段的逐级收缩范围确定。

### 11.2 基本流程

1. 在目标级别找到背驰段
2. 去次级别里找对应背驰段
3. 逐级重复，直到最低关注级别
4. 最终转折点落在最低级别背驰段确定的范围内

### 11.3 理论依据（编码时的“前提”）

- **低级别背驰是本级别背驰的必要条件（非充分）**：只有低级别发生背驰，本级别才“可能”背驰

### 11.4 递归 vs 区间套（入门补充）

- **递归**：用于描述走势如何从小到大生长（分型 → 笔 → 线段 → 走势类型/中枢…）
- **区间套**：用于观察走势如何从大到小终结（从大级别背驰段逐级缩到更小级别的背驰段）

### 11.5 小转大（入门补充）

- 小转大是用区间套和背驰不可解释的情况的一种补充
- 小转大没有标准的一类买卖点，通常需要等待第二类买卖点确认

---

## 12. 核心定义出处（便于回溯）

以下行号均指 `docs/chanlun/mineru/缠中说禅-股市技术理论/full.md`：

- K线包含关系：约 L215-L257
- 分型：约 L259-L317
- 笔：约 L318-L360
- 线段：约 L362-L438
- 走势中枢 & 中心定理：约 L440-L493
- 走势类型 & 级别延续：约 L494-L519
- 走势必完美 / 走势分解：约 L541-L582
- 背驰 / MACD 辅助：约 L689-L756
- 三类买卖点：约 L1148-L1167
- 区间套：约 L1278-L1293

---

> 更新日期：2026-02-13
